Timeline._Band=function(e,t,i){e.autoWidth&&"string"==typeof t.width&&(t.width=t.width.indexOf("%")>-1?0:parseInt(t.width)),this._timeline=e,this._bandInfo=t,this._index=i,this._locale="locale"in t?t.locale:Timeline.getDefaultLocale(),this._timeZone="timeZone"in t?t.timeZone:0,this._labeller="labeller"in t?t.labeller:"createLabeller"in e.getUnit()?e.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone),this._theme=t.theme,this._zoomIndex="zoomIndex"in t?t.zoomIndex:0,this._zoomSteps="zoomSteps"in t?t.zoomSteps:null,this._dragging=!1,this._changing=!1,this._originalScrollSpeed=5,this._scrollSpeed=this._originalScrollSpeed,this._onScrollListeners=[];var n=this;this._syncWithBand=null,this._syncWithBandHandler=function(e){n._onHighlightBandScroll()},this._selectorListener=function(e){n._onHighlightBandScroll()};var a=this._timeline.getDocument().createElement("div");a.className="timeline-band-input",this._timeline.addDiv(a),this._keyboardInput=document.createElement("input"),this._keyboardInput.type="text",a.appendChild(this._keyboardInput),SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown"),SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp"),this._div=this._timeline.getDocument().createElement("div"),this._div.id="timeline-band-"+i,this._div.className="timeline-band timeline-band-"+i,this._timeline.addDiv(this._div),SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown"),SimileAjax.DOM.registerEventWithObject(this._div,"mousemove",this,"_onMouseMove"),SimileAjax.DOM.registerEventWithObject(this._div,"mouseup",this,"_onMouseUp"),SimileAjax.DOM.registerEventWithObject(this._div,"mouseout",this,"_onMouseOut"),SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");var r=null!=this._theme?this._theme.mouseWheel:"scroll";("zoom"===r||"scroll"===r||this._zoomSteps)&&(SimileAjax.Platform.browser.isFirefox?SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll"):SimileAjax.DOM.registerEventWithObject(this._div,"mousewheel",this,"_onMouseScroll")),this._innerDiv=this._timeline.getDocument().createElement("div"),this._innerDiv.className="timeline-band-inner",this._div.appendChild(this._innerDiv),this._ether=t.ether,t.ether.initialize(this,e),this._etherPainter=t.etherPainter,t.etherPainter.initialize(this,e),this._eventSource=t.eventSource,this._eventSource&&(this._eventListener={onAddMany:function(){n._onAddMany()},onClear:function(){n._onClear()}},this._eventSource.addListener(this._eventListener)),this._eventPainter=t.eventPainter,this._eventTracksNeeded=0,this._eventTrackIncrement=0,t.eventPainter.initialize(this,e),this._decorators="decorators"in t?t.decorators:[];for(var s=0;s<this._decorators.length;s++)this._decorators[s].initialize(this,e)},Timeline._Band.SCROLL_MULTIPLES=5,Timeline._Band.prototype.dispose=function(){this.closeBubble(),this._eventSource&&(this._eventSource.removeListener(this._eventListener),this._eventListener=null,this._eventSource=null),this._timeline=null,this._bandInfo=null,this._labeller=null,this._ether=null,this._etherPainter=null,this._eventPainter=null,this._decorators=null,this._onScrollListeners=null,this._syncWithBandHandler=null,this._selectorListener=null,this._div=null,this._innerDiv=null,this._keyboardInput=null},Timeline._Band.prototype.addOnScrollListener=function(e){this._onScrollListeners.push(e)},Timeline._Band.prototype.removeOnScrollListener=function(e){for(var t=0;t<this._onScrollListeners.length;t++)if(this._onScrollListeners[t]==e){this._onScrollListeners.splice(t,1);break}},Timeline._Band.prototype.setSyncWithBand=function(e,t){this._syncWithBand&&this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler),this._syncWithBand=e,this._syncWithBand.addOnScrollListener(this._syncWithBandHandler),this._highlight=t,this._positionHighlight()},Timeline._Band.prototype.getLocale=function(){return this._locale},Timeline._Band.prototype.getTimeZone=function(){return this._timeZone},Timeline._Band.prototype.getLabeller=function(){return this._labeller},Timeline._Band.prototype.getIndex=function(){return this._index},Timeline._Band.prototype.getEther=function(){return this._ether},Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter},Timeline._Band.prototype.getEventSource=function(){return this._eventSource},Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter},Timeline._Band.prototype.getTimeline=function(){return this._timeline},Timeline._Band.prototype.updateEventTrackInfo=function(e,t){this._eventTrackIncrement=t,e>this._eventTracksNeeded&&(this._eventTracksNeeded=e)},Timeline._Band.prototype.checkAutoWidth=function(){if(this._timeline.autoWidth){var e="overview"==this._eventPainter.getType(),t=e?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin,i=Math.ceil((this._eventTracksNeeded+t)*this._eventTrackIncrement);i+=e?this._theme.event.overviewTrack.offset:this._theme.event.track.offset;var n=this._bandInfo;i!=n.width&&(n.width=i)}},Timeline._Band.prototype.layout=function(){this.paint()},Timeline._Band.prototype.paint=function(){this._etherPainter.paint(),this._paintDecorators(),this._paintEvents()},Timeline._Band.prototype.softLayout=function(){this.softPaint()},Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint(),this._softPaintDecorators(),this._softPaintEvents()},Timeline._Band.prototype.setBandShiftAndWidth=function(e,t){var i=this._keyboardInput.parentNode,n=e+Math.floor(t/2);this._timeline.isHorizontal()?(this._div.style.top=e+"px",this._div.style.height=t+"px",i.style.top=n+"px",i.style.left="-1em"):(this._div.style.left=e+"px",this._div.style.width=t+"px",i.style.left=n+"px",i.style.top="-1em")},Timeline._Band.prototype.getViewWidth=function(){return this._timeline.isHorizontal()?this._div.offsetHeight:this._div.offsetWidth},Timeline._Band.prototype.setViewLength=function(e){this._viewLength=e,this._recenterDiv(),this._onChanging()},Timeline._Band.prototype.getViewLength=function(){return this._viewLength},Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength},Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset},Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)},Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)},Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)},Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(e){return this._ether.pixelOffsetToDate(e)},Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)},Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(e){return this._ether.pixelOffsetToDate(this._viewLength+e)},Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)},Timeline._Band.prototype.setMinVisibleDate=function(e){this._changing||this._moveEther(Math.round(-this._ether.dateToPixelOffset(e)))},Timeline._Band.prototype.setMaxVisibleDate=function(e){this._changing||this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(e)))},Timeline._Band.prototype.setCenterVisibleDate=function(e){this._changing||this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(e)))},Timeline._Band.prototype.dateToPixelOffset=function(e){return this._ether.dateToPixelOffset(e)-this._viewOffset},Timeline._Band.prototype.pixelOffsetToDate=function(e){return this._ether.pixelOffsetToDate(e+this._viewOffset)},Timeline._Band.prototype.createLayerDiv=function(e,t){var i=this._timeline.getDocument().createElement("div");i.className="timeline-band-layer"+("string"==typeof t?" "+t:""),i.style.zIndex=e,this._innerDiv.appendChild(i);var n=this._timeline.getDocument().createElement("div");return n.className="timeline-band-layer-inner",SimileAjax.Platform.browser.isIE?n.style.cursor="move":n.style.cursor="-moz-grab",i.appendChild(n),n},Timeline._Band.prototype.removeLayerDiv=function(e){this._innerDiv.removeChild(e.parentNode)},Timeline._Band.prototype.scrollToCenter=function(e,t){var i=this._ether.dateToPixelOffset(e);i<-this._viewLength/2?this.setCenterVisibleDate(this.pixelOffsetToDate(i+this._viewLength)):i>3*this._viewLength/2&&this.setCenterVisibleDate(this.pixelOffsetToDate(i-this._viewLength)),this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(e)),t)},Timeline._Band.prototype.showBubbleForEvent=function(e){var t=this.getEventSource().getEvent(e);if(t){var i=this;this.scrollToCenter(t.getStart(),function(){i._eventPainter.showBubble(t)})}},Timeline._Band.prototype.zoom=function(e,t,i,n){if(this._zoomSteps){t+=this._viewOffset;var a=this._ether.pixelOffsetToDate(t),r=this._ether.zoom(e);this._etherPainter.zoom(r),this._moveEther(Math.round(-this._ether.dateToPixelOffset(a))),this._moveEther(t)}},Timeline._Band.prototype._onMouseDown=function(e,t,i){this.closeBubble(),this._dragging=!0,this._dragX=t.clientX,this._dragY=t.clientY},Timeline._Band.prototype._onMouseMove=function(e,t,i){if(this._dragging){var n=t.clientX-this._dragX,a=t.clientY-this._dragY;this._dragX=t.clientX,this._dragY=t.clientY,this._moveEther(this._timeline.isHorizontal()?n:a),this._positionHighlight()}},Timeline._Band.prototype._onMouseUp=function(e,t,i){this._dragging=!1,this._keyboardInput.select()},Timeline._Band.prototype._onMouseOut=function(e,t,i){var n=SimileAjax.DOM.getEventRelativeCoordinates(t,e);n.x+=this._viewOffset,(n.x<0||n.x>e.offsetWidth||n.y<0||n.y>e.offsetHeight)&&(this._dragging=!1)},Timeline._Band.prototype._onMouseScroll=function(e,t,i){var n=new Date;if(n=n.getTime(),!this._lastScrollTime||n-this._lastScrollTime>50){this._lastScrollTime=n;var a=0;t.wheelDelta?a=t.wheelDelta/120:t.detail&&(a=-t.detail/3);var r=this._theme.mouseWheel;if(this._zoomSteps||"zoom"===r){var s=SimileAjax.DOM.getEventRelativeCoordinates(t,e);if(0!=a){var l;a>0&&(l=!0),0>a&&(l=!1),this._timeline.zoom(l,s.x,s.y,e)}}else if("scroll"===r){var o=50*(0>a?-1:1);this._moveEther(o)}}t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.preventDefault&&t.preventDefault(),t.returnValue=!1},Timeline._Band.prototype._onDblClick=function(e,t,i){var n=SimileAjax.DOM.getEventRelativeCoordinates(t,e),a=n.x-(this._viewLength/2-this._viewOffset);this._autoScroll(-a)},Timeline._Band.prototype._onKeyDown=function(e,t,i){if(!this._dragging){switch(t.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(1.05*this._scrollSpeed)),this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(1.05*this._scrollSpeed)),this._moveEther(this._scrollSpeed);break;default:return!0}return this.closeBubble(),SimileAjax.DOM.cancelEvent(t),!1}return!0},Timeline._Band.prototype._onKeyUp=function(e,t,i){if(!this._dragging){switch(this._scrollSpeed=this._originalScrollSpeed,t.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return!0}return this.closeBubble(),SimileAjax.DOM.cancelEvent(t),!1}return!0},Timeline._Band.prototype._autoScroll=function(e,t){var i=this,n=SimileAjax.Graphics.createAnimation(function(e,t){i._moveEther(t)},0,e,1e3,t);n.run()},Timeline._Band.prototype._moveEther=function(e){this.closeBubble(),this._timeline.shiftOK(this._index,e)&&(this._viewOffset+=e,this._ether.shiftPixels(-e),this._timeline.isHorizontal()?this._div.style.left=this._viewOffset+"px":this._div.style.top=this._viewOffset+"px",this._viewOffset>.5*-this._viewLength||this._viewOffset<-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)?this._recenterDiv():this.softLayout(),this._onChanging())},Timeline._Band.prototype._onChanging=function(){this._changing=!0,this._fireOnScroll(),this._setSyncWithBandDate(),this._changing=!1},Timeline._Band.prototype.busy=function(){return this._changing},Timeline._Band.prototype._fireOnScroll=function(){for(var e=0;e<this._onScrollListeners.length;e++)this._onScrollListeners[e](this)},Timeline._Band.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var e=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(e)}},Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var e=this._syncWithBand.getCenterVisibleDate(),t=this._ether.dateToPixelOffset(e);this._moveEther(Math.round(this._viewLength/2-t)),this._highlight&&this._etherPainter.setHighlight(this._syncWithBand.getMinVisibleDate(),this._syncWithBand.getMaxVisibleDate())}},Timeline._Band.prototype._onAddMany=function(){this._paintEvents()},Timeline._Band.prototype._onClear=function(){this._paintEvents()},Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var e=this._syncWithBand.getMinVisibleDate(),t=this._syncWithBand.getMaxVisibleDate();this._highlight&&this._etherPainter.setHighlight(e,t)}},Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2,this._timeline.isHorizontal()?(this._div.style.left=this._viewOffset+"px",this._div.style.width=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"):(this._div.style.top=this._viewOffset+"px",this._div.style.height=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"),this.layout()},Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint()},Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()},Timeline._Band.prototype._paintDecorators=function(){for(var e=0;e<this._decorators.length;e++)this._decorators[e].paint()},Timeline._Band.prototype._softPaintDecorators=function(){for(var e=0;e<this._decorators.length;e++)this._decorators[e].softPaint()},Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()},Timeline.CompactEventPainter=function(e){this._params=e,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}},Timeline.CompactEventPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},Timeline.CompactEventPainter.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.CompactEventPainter.prototype.setFilterMatcher=function(e){this._filterMatcher=e},Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},Timeline.CompactEventPainter.prototype.paint=function(){var e=this._band.getEventSource();if(null!=e){this._eventIdToElmt={},this._prepareForPainting();var t=this._params.theme,i=t.event,n={trackOffset:"trackOffset"in this._params?this._params.trackOffset:10,trackHeight:"trackHeight"in this._params?this._params.trackHeight:10,tapeHeight:t.event.tape.height,tapeBottomMargin:"tapeBottomMargin"in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin"in this._params?this._params.labelBottomMargin:5,labelRightMargin:"labelRightMargin"in this._params?this._params.labelRightMargin:5,defaultIcon:i.instant.icon,defaultIconWidth:i.instant.iconWidth,defaultIconHeight:i.instant.iconHeight,customIconWidth:"iconWidth"in this._params?this._params.iconWidth:i.instant.iconWidth,customIconHeight:"iconHeight"in this._params?this._params.iconHeight:i.instant.iconHeight,iconLabelGap:"iconLabelGap"in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin"in this._params?this._params.iconBottomMargin:2};"compositeIcon"in this._params?(n.compositeIcon=this._params.compositeIcon,n.compositeIconWidth=this._params.compositeIconWidth||n.customIconWidth,n.compositeIconHeight=this._params.compositeIconHeight||n.customIconHeight):(n.compositeIcon=n.defaultIcon,n.compositeIconWidth=n.defaultIconWidth,n.compositeIconHeight=n.defaultIconHeight),n.defaultStackIcon="icon"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:n.defaultIcon,n.defaultStackIconWidth="iconWidth"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:n.defaultIconWidth,n.defaultStackIconHeight="iconHeight"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:n.defaultIconHeight;var a=this._band.getMinDate(),r=this._band.getMaxDate(),s=null!=this._filterMatcher?this._filterMatcher:function(e){return!0},l=null!=this._highlightMatcher?this._highlightMatcher:function(e){return-1},o=e.getEventIterator(a,r),h="stackConcurrentPreciseInstantEvents"in this._params&&"object"==typeof this._params.stackConcurrentPreciseInstantEvents,c="collapseConcurrentPreciseInstantEvents"in this._params&&this._params.collapseConcurrentPreciseInstantEvents;if(c||h){for(var m=[],p=null;o.hasNext();){var _=o.next();s(_)&&(!_.isInstant()||_.isImprecise()?this.paintEvent(_,n,this._params.theme,l(_)):null!=p&&p.getStart().getTime()==_.getStart().getTime()?m[m.length-1].push(_):(m.push([_]),p=_))}for(var u=0;u<m.length;u++){var d=m[u];if(1==d.length)this.paintEvent(d[0],n,this._params.theme,l(_));else{for(var g=-1,v=0;0>g&&v<d.length;v++)g=l(d[v]);h?this.paintStackedPreciseInstantEvents(d,n,this._params.theme,g):this.paintCompositePreciseInstantEvents(d,n,this._params.theme,g)}}}else for(;o.hasNext();){var _=o.next();s(_)&&this.paintEvent(_,n,this._params.theme,l(_))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block"}},Timeline.CompactEventPainter.prototype.softPaint=function(){},Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var e=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var t=document.createElement("span");t.className="timeline-event-label",this._backLayer.appendChild(t),this._frc=SimileAjax.Graphics.getFontRenderingContext(t)}this._frc.update(),this._tracks=[],null!=this._highlightLayer&&e.removeLayerDiv(this._highlightLayer),this._highlightLayer=e.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._lineLayer&&e.removeLayerDiv(this._lineLayer),this._lineLayer=e.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",null!=this._eventLayer&&e.removeLayerDiv(this._eventLayer),this._eventLayer=e.createLayerDiv(115,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.CompactEventPainter.prototype.paintEvent=function(e,t,i,n){e.isInstant()?this.paintInstantEvent(e,t,i,n):this.paintDurationEvent(e,t,i,n)},Timeline.CompactEventPainter.prototype.paintInstantEvent=function(e,t,i,n){e.isImprecise()?this.paintImpreciseInstantEvent(e,t,i,n):this.paintPreciseInstantEvent(e,t,i,n)},Timeline.CompactEventPainter.prototype.paintDurationEvent=function(e,t,i,n){e.isImprecise()?this.paintImpreciseDurationEvent(e,t,i,n):this.paintPreciseDurationEvent(e,t,i,n)},Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(e,t,i,n){var a={tooltip:e.getProperty("tooltip")||e.getText()},r={url:e.getIcon()};null==r.url?(r.url=t.defaultIcon,r.width=t.defaultIconWidth,r.height=t.defaultIconHeight,r.className="timeline-event-icon-default"):(r.width=e.getProperty("iconWidth")||t.customIconWidth,r.height=e.getProperty("iconHeight")||t.customIconHeight);var s={text:e.getText(),color:e.getTextColor()||e.getColor(),className:e.getClassName()},l=this.paintTapeIconLabel(e.getStart(),a,null,r,s,t,i,n),o=this,h=function(t,i,n){return o._onClickInstantEvent(l.iconElmtData.elmt,i,e)};SimileAjax.DOM.registerEvent(l.iconElmtData.elmt,"mousedown",h),SimileAjax.DOM.registerEvent(l.labelElmtData.elmt,"mousedown",h),this._eventIdToElmt[e.getID()]=l.iconElmtData.elmt},Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(e,t,i,n){for(var a=e[0],r=[],s=0;s<e.length;s++)r.push(e[s].getProperty("tooltip")||e[s].getText());var l={tooltip:r.join("; ")},o={url:t.compositeIcon,width:t.compositeIconWidth,height:t.compositeIconHeight,className:"timeline-event-icon-composite"},h={text:String.substitute(this._params.compositeEventLabelTemplate,[e.length])},c=this.paintTapeIconLabel(a.getStart(),l,null,o,h,t,i,n),m=this,p=function(t,i,n){return m._onClickMultiplePreciseInstantEvent(c.iconElmtData.elmt,i,e)};SimileAjax.DOM.registerEvent(c.iconElmtData.elmt,"mousedown",p),SimileAjax.DOM.registerEvent(c.labelElmtData.elmt,"mousedown",p);for(var s=0;s<e.length;s++)this._eventIdToElmt[e[s].getID()]=c.iconElmtData.elmt},Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(e,t,i,n){for(var a=("limit"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10),r=("moreMessageTemplate"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events"),s=a<=e.length-2,l=this._band,o=function(e){return Math.round(l.dateToPixelOffset(e))},h=function(e){var i={url:e.getIcon()};return null==i.url?(i.url=t.defaultStackIcon,i.width=t.defaultStackIconWidth,i.height=t.defaultStackIconHeight,i.className="timeline-event-icon-stack timeline-event-icon-default"):(i.width=e.getProperty("iconWidth")||t.customIconWidth,i.height=e.getProperty("iconHeight")||t.customIconHeight,i.className="timeline-event-icon-stack"),i},c=h(e[0]),m=5,p=0,_=0,u=0,d=0,g=[],v=0;v<e.length&&(!s||a>v);v++){var f=e[v],y=f.getText(),T=h(f),b=this._frc.computeSize(y),E={text:y,iconData:T,labelSize:b,iconLeft:c.width+v*m-T.width};E.labelLeft=c.width+v*m+t.iconLabelGap,E.top=u,g.push(E),p=Math.min(p,E.iconLeft),u+=b.height,_=Math.max(_,E.labelLeft+b.width),d=Math.max(d,E.top+T.height)}if(s){var D=String.substitute(r,[e.length-a]),L=this._frc.computeSize(D),x=c.width+(a-1)*m+t.iconLabelGap,I=u;u+=L.height,_=Math.max(_,x+L.width)}_+=t.labelRightMargin,u+=t.labelBottomMargin,d+=t.iconBottomMargin;for(var k=o(e[0].getStart()),S=[],P=Math.ceil(Math.max(d,u)/t.trackHeight),w=c.width+(e.length-1)*m,v=0;P>v;v++)S.push({start:p,end:w});for(var M=Math.ceil(u/t.trackHeight),v=0;M>v;v++){var O=S[v];O.end=Math.max(O.end,_)}var C=this._fitTracks(k,S),A=C*t.trackHeight+t.trackOffset,N=this._timeline.getDocument().createElement("div");N.className="timeline-event-icon-stack",N.style.position="absolute",N.style.overflow="visible",N.style.left=k+"px",N.style.top=A+"px",N.style.width=w+"px",N.style.height=d+"px",N.innerHTML="<div style='position: relative'></div>",this._eventLayer.appendChild(N);for(var H=this,j=function(e){try{for(var t=parseInt(this.getAttribute("index")),i=N.firstChild.childNodes,n=0;n<i.length;n++){var a=i[n];n==t?a.style.zIndex=i.length:a.style.zIndex=i.length-n}}catch(r){}},B=(function(t){var n=g[t],a=e[t],r=a.getProperty("tooltip")||a.getText(),s=H._paintEventLabel({tooltip:r},{text:n.text},k+n.labelLeft,A+n.top,n.labelSize.width,n.labelSize.height,i);s.elmt.setAttribute("index",t),s.elmt.onmouseover=j;var l=SimileAjax.Graphics.createTranslucentImage(n.iconData.url),o=H._timeline.getDocument().createElement("div");o.className="timeline-event-icon"+("className"in n.iconData?" "+n.iconData.className:""),o.style.left=n.iconLeft+"px",o.style.top=n.top+"px",o.style.zIndex=g.length-t,o.appendChild(l),o.setAttribute("index",t),o.onmouseover=j,N.firstChild.appendChild(o);var h=function(e,t,i){return H._onClickInstantEvent(s.elmt,t,a)};SimileAjax.DOM.registerEvent(o,"mousedown",h),SimileAjax.DOM.registerEvent(s.elmt,"mousedown",h),H._eventIdToElmt[a.getID()]=o}),v=0;v<g.length;v++)B(v);if(s){var z=e.slice(a),W=this._paintEventLabel({tooltip:D},{text:D},k+x,A+I,L.width,L.height,i),F=function(e,t,i){return H._onClickMultiplePreciseInstantEvent(W.elmt,t,z)};SimileAjax.DOM.registerEvent(W.elmt,"mousedown",F);for(var v=0;v<z.length;v++)this._eventIdToElmt[z[v].getID()]=W.elmt}},Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(e,t,i,n){var a={tooltip:e.getProperty("tooltip")||e.getText()},r={start:e.getStart(),end:e.getEnd(),latestStart:e.getLatestStart(),earliestEnd:e.getEarliestEnd(),isInstant:!0},s={url:e.getIcon()};null==s.url?s=null:(s.width=e.getProperty("iconWidth")||t.customIconWidth,s.height=e.getProperty("iconHeight")||t.customIconHeight);var l={text:e.getText(),color:e.getTextColor()||e.getColor(),className:e.getClassName()},o=this.paintTapeIconLabel(e.getStart(),a,r,s,l,t,i,n),h=this,c=null!=s?function(t,i,n){return h._onClickInstantEvent(o.iconElmtData.elmt,i,e)}:function(t,i,n){return h._onClickInstantEvent(o.labelElmtData.elmt,i,e)};SimileAjax.DOM.registerEvent(o.labelElmtData.elmt,"mousedown",c),SimileAjax.DOM.registerEvent(o.impreciseTapeElmtData.elmt,"mousedown",c),null!=s?(SimileAjax.DOM.registerEvent(o.iconElmtData.elmt,"mousedown",c),this._eventIdToElmt[e.getID()]=o.iconElmtData.elmt):this._eventIdToElmt[e.getID()]=o.labelElmtData.elmt},Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(e,t,i,n){var a={tooltip:e.getProperty("tooltip")||e.getText()},r={start:e.getStart(),end:e.getEnd(),isInstant:!1},s={url:e.getIcon()};null==s.url?s=null:(s.width=e.getProperty("iconWidth")||t.customIconWidth,s.height=e.getProperty("iconHeight")||t.customIconHeight);var l={text:e.getText(),color:e.getTextColor()||e.getColor(),className:e.getClassName()},o=this.paintTapeIconLabel(e.getLatestStart(),a,r,s,l,t,i,n),h=this,c=null!=s?function(t,i,n){return h._onClickInstantEvent(o.iconElmtData.elmt,i,e)}:function(t,i,n){return h._onClickInstantEvent(o.labelElmtData.elmt,i,e)};SimileAjax.DOM.registerEvent(o.labelElmtData.elmt,"mousedown",c),SimileAjax.DOM.registerEvent(o.tapeElmtData.elmt,"mousedown",c),null!=s?(SimileAjax.DOM.registerEvent(o.iconElmtData.elmt,"mousedown",c),this._eventIdToElmt[e.getID()]=o.iconElmtData.elmt):this._eventIdToElmt[e.getID()]=o.labelElmtData.elmt},Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(e,t,i,n){var a={tooltip:e.getProperty("tooltip")||e.getText()},r={start:e.getStart(),end:e.getEnd(),latestStart:e.getLatestStart(),earliestEnd:e.getEarliestEnd(),isInstant:!1},s={url:e.getIcon()};null==s.url?s=null:(s.width=e.getProperty("iconWidth")||t.customIconWidth,s.height=e.getProperty("iconHeight")||t.customIconHeight);var l={text:e.getText(),color:e.getTextColor()||e.getColor(),className:e.getClassName()},o=this.paintTapeIconLabel(e.getLatestStart(),a,r,s,l,t,i,n),h=this,c=null!=s?function(t,i,n){return h._onClickInstantEvent(o.iconElmtData.elmt,i,e)}:function(t,i,n){return h._onClickInstantEvent(o.labelElmtData.elmt,i,e)};SimileAjax.DOM.registerEvent(o.labelElmtData.elmt,"mousedown",c),SimileAjax.DOM.registerEvent(o.tapeElmtData.elmt,"mousedown",c),null!=s?(SimileAjax.DOM.registerEvent(o.iconElmtData.elmt,"mousedown",c),this._eventIdToElmt[e.getID()]=o.iconElmtData.elmt):this._eventIdToElmt[e.getID()]=o.labelElmtData.elmt},Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(e,t,i,n,a,r,s,l){var o=this._band,h=function(e){return Math.round(o.dateToPixelOffset(e))},c=h(e),m=[],p=0,_=0,u=0;if(null!=i){p=r.tapeHeight+r.tapeBottomMargin,_=Math.ceil(r.tapeHeight/r.trackHeight);for(var d=h(i.end)-c,g=h(i.start)-c,v=0;_>v;v++)m.push({start:g,end:d});u=r.trackHeight-p%r.tapeHeight}var f=0,y=0;if(null!=n){"iconAlign"in n&&"center"==n.iconAlign&&(f=-Math.floor(n.width/2)),y=f+n.width+r.iconLabelGap,_>0&&(m[_-1].end=Math.max(m[_-1].end,y));for(var T=n.height+r.iconBottomMargin+u;T>0;)m.push({start:f,end:y}),T-=r.trackHeight}var b=a.text,E=this._frc.computeSize(b),D=E.height+r.labelBottomMargin+u,L=y+E.width+r.labelRightMargin;_>0&&(m[_-1].end=Math.max(m[_-1].end,L));for(var x=0;D>0;x++){if(_+x<m.length){var I=m[_+x];I.end=L}else m.push({start:0,end:L});D-=r.trackHeight}var k=this._fitTracks(c,m),S=k*r.trackHeight+r.trackOffset,P={};return P.labelElmtData=this._paintEventLabel(t,a,c+y,S+p,E.width,E.height,s),null!=i&&(("latestStart"in i||"earliestEnd"in i)&&(P.impreciseTapeElmtData=this._paintEventTape(t,i,r.tapeHeight,S,h(i.start),h(i.end),s.event.duration.impreciseColor,s.event.duration.impreciseOpacity,r,s)),!i.isInstant&&"start"in i&&"end"in i&&(P.tapeElmtData=this._paintEventTape(t,i,r.tapeHeight,S,c,h("earliestEnd"in i?i.earliestEnd:i.end),i.color,100,r,s))),null!=n&&(P.iconElmtData=this._paintEventIcon(t,n,S+p,c+f,r,s)),P},Timeline.CompactEventPainter.prototype._fitTracks=function(e,t){var i;for(i=0;i<this._tracks.length;i++){for(var n=!0,a=0;a<t.length&&i+a<this._tracks.length;a++){var r=this._tracks[i+a],s=t[a];if(e+s.start<r){n=!1;break}}if(n)break}for(var l=0;l<t.length;l++)this._tracks[i+l]=e+t[l].end;return i},Timeline.CompactEventPainter.prototype._paintEventIcon=function(e,t,i,n,a,r){var s=SimileAjax.Graphics.createTranslucentImage(t.url),l=this._timeline.getDocument().createElement("div");return l.className="timeline-event-icon"+("className"in t?" "+t.className:""),l.style.left=n+"px",l.style.top=i+"px",l.appendChild(s),"tooltip"in e&&"string"==typeof e.tooltip&&(l.title=e.tooltip),this._eventLayer.appendChild(l),{left:n,top:i,width:a.iconWidth,height:a.iconHeight,elmt:l}},Timeline.CompactEventPainter.prototype._paintEventLabel=function(e,t,i,n,a,r,s){var l=this._timeline.getDocument(),o=l.createElement("div");return o.className="timeline-event-label",o.style.left=i+"px",o.style.width=a+1+"px",o.style.top=n+"px",o.innerHTML=t.text,"tooltip"in e&&"string"==typeof e.tooltip&&(o.title=e.tooltip),"color"in t&&"string"==typeof t.color&&(o.style.color=t.color),"className"in t&&"string"==typeof t.className&&(o.className+=" "+t.className),this._eventLayer.appendChild(o),{left:i,top:n,width:a,height:r,elmt:o}},Timeline.CompactEventPainter.prototype._paintEventTape=function(e,t,i,n,a,r,s,l,o,h){var c=r-a,m=this._timeline.getDocument().createElement("div");return m.className="timeline-event-tape",m.style.left=a+"px",m.style.top=n+"px",m.style.width=c+"px",m.style.height=i+"px","tooltip"in e&&"string"==typeof e.tooltip&&(m.title=e.tooltip),null!=s&&"string"==typeof t.color&&(m.style.backgroundColor=s),"backgroundImage"in t&&"string"==typeof t.backgroundImage&&(m.style.backgroundImage="url("+backgroundImage+")",m.style.backgroundRepeat="backgroundRepeat"in t&&"string"==typeof t.backgroundRepeat?t.backgroundRepeat:"repeat"),SimileAjax.Graphics.setOpacity(m,l),"className"in t&&"string"==typeof t.className&&(m.className+=" "+t.className),this._eventLayer.appendChild(m),{left:a,top:n,width:c,height:i,elmt:m}},Timeline.CompactEventPainter.prototype._createHighlightDiv=function(e,t,i){if(e>=0){var n=this._timeline.getDocument(),a=i.event,r=(a.highlightColors[Math.min(e,a.highlightColors.length-1)],n.createElement("div"));r.style.position="absolute",r.style.overflow="hidden",r.style.left=t.left-2+"px",r.style.width=t.width+4+"px",r.style.top=t.top-2+"px",r.style.height=t.height+4+"px",this._highlightLayer.appendChild(r)}},Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(e,t,i){var n=SimileAjax.DOM.getPageCoordinates(e);this._showBubble(n.left+Math.ceil(e.offsetWidth/2),n.top+Math.ceil(e.offsetHeight/2),i);for(var a=[],r=0;r<i.length;r++)a.push(i[r].getID());return this._fireOnSelect(a),t.cancelBubble=!0,SimileAjax.DOM.cancelEvent(t),!1},Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(e,t,i){var n=SimileAjax.DOM.getPageCoordinates(e);return this._showBubble(n.left+Math.ceil(e.offsetWidth/2),n.top+Math.ceil(e.offsetHeight/2),[i]),this._fireOnSelect([i.getID()]),t.cancelBubble=!0,SimileAjax.DOM.cancelEvent(t),!1},Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(e,t,i){if("pageX"in t)var n=t.pageX,a=t.pageY;else var r=SimileAjax.DOM.getPageCoordinates(e),n=t.offsetX+r.left,a=t.offsetY+r.top;return this._showBubble(n,a,[i]),this._fireOnSelect([i.getID()]),t.cancelBubble=!0,SimileAjax.DOM.cancelEvent(t),!1},Timeline.CompactEventPainter.prototype.showBubble=function(e){
var t=this._eventIdToElmt[e.getID()];if(t){var i=SimileAjax.DOM.getPageCoordinates(t);this._showBubble(i.left+t.offsetWidth/2,i.top+t.offsetHeight/2,[e])}},Timeline.CompactEventPainter.prototype._showBubble=function(e,t,i){var n=document.createElement("div");i="fillInfoBubble"in i?[i]:i;for(var a=0;a<i.length;a++){var r=document.createElement("div");n.appendChild(r),i[a].fillInfoBubble(r,this._params.theme,this._band.getLabeller())}SimileAjax.WindowManager.cancelPopups(),SimileAjax.Graphics.createBubbleForContentAndPoint(n,e,t,this._params.theme.event.bubble.width)},Timeline.CompactEventPainter.prototype._fireOnSelect=function(e){for(var t=0;t<this._onSelectListeners.length;t++)this._onSelectListeners[t](e)},Timeline.SpanHighlightDecorator=function(e){this._unit=null!=e.unit?e.unit:SimileAjax.NativeDateUnit,this._startDate="string"==typeof e.startDate?this._unit.parseFromObject(e.startDate):e.startDate,this._endDate="string"==typeof e.endDate?this._unit.parseFromObject(e.endDate):e.endDate,this._startLabel=null!=e.startLabel?e.startLabel:"",this._endLabel=null!=e.endLabel?e.endLabel:"",this._color=e.color,this._cssClass=null!=e.cssClass?e.cssClass:null,this._opacity=null!=e.opacity?e.opacity:100,this._zIndex=null!=e.inFront&&e.inFront?113:10},Timeline.SpanHighlightDecorator.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._layerDiv=null},Timeline.SpanHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv),this._layerDiv=this._band.createLayerDiv(this._zIndex),this._layerDiv.setAttribute("name","span-highlight-decorator"),this._layerDiv.style.display="none";var e=this._band.getMinDate(),t=this._band.getMaxDate();if(this._unit.compare(this._startDate,t)<0&&this._unit.compare(this._endDate,e)>0){e=this._unit.later(e,this._startDate),t=this._unit.earlier(t,this._endDate);var i=this._band.dateToPixelOffset(e),n=this._band.dateToPixelOffset(t),a=this._timeline.getDocument(),r=function(){var e=a.createElement("table");return e.insertRow(0).insertCell(0),e},s=a.createElement("div");s.className="timeline-highlight-decorator",this._cssClass&&(s.className+=" "+this._cssClass),null!=this._color&&(s.style.backgroundColor=this._color),this._opacity<100&&SimileAjax.Graphics.setOpacity(s,this._opacity),this._layerDiv.appendChild(s);var l=r();l.className="timeline-highlight-label timeline-highlight-label-start";var o=l.rows[0].cells[0];o.innerHTML=this._startLabel,this._cssClass&&(o.className="label_"+this._cssClass),this._layerDiv.appendChild(l);var h=r();h.className="timeline-highlight-label timeline-highlight-label-end";var c=h.rows[0].cells[0];c.innerHTML=this._endLabel,this._cssClass&&(c.className="label_"+this._cssClass),this._layerDiv.appendChild(h),this._timeline.isHorizontal()?(s.style.left=i+"px",s.style.width=n-i+"px",l.style.right=this._band.getTotalViewLength()-i+"px",l.style.width=this._startLabel.length+"em",h.style.left=n+"px",h.style.width=this._endLabel.length+"em"):(s.style.top=i+"px",s.style.height=n-i+"px",l.style.bottom=i+"px",l.style.height="1.5px",h.style.top=n+"px",h.style.height="1.5px")}this._layerDiv.style.display="block"},Timeline.SpanHighlightDecorator.prototype.softPaint=function(){},Timeline.PointHighlightDecorator=function(e){this._unit=null!=e.unit?e.unit:SimileAjax.NativeDateUnit,this._date="string"==typeof e.date?this._unit.parseFromObject(e.date):e.date,this._width=null!=e.width?e.width:10,this._color=e.color,this._cssClass=null!=e.cssClass?e.cssClass:"",this._opacity=null!=e.opacity?e.opacity:100},Timeline.PointHighlightDecorator.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._layerDiv=null},Timeline.PointHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv),this._layerDiv=this._band.createLayerDiv(10),this._layerDiv.setAttribute("name","span-highlight-decorator"),this._layerDiv.style.display="none";var e=this._band.getMinDate(),t=this._band.getMaxDate();if(this._unit.compare(this._date,t)<0&&this._unit.compare(this._date,e)>0){var i=this._band.dateToPixelOffset(this._date),n=i-Math.round(this._width/2),a=this._timeline.getDocument(),r=a.createElement("div");r.className="timeline-highlight-point-decorator",r.className+=" "+this._cssClass,null!=this._color&&(r.style.backgroundColor=this._color),this._opacity<100&&SimileAjax.Graphics.setOpacity(r,this._opacity),this._layerDiv.appendChild(r),this._timeline.isHorizontal()?(r.style.left=n+"px",r.style.width=this._width):(r.style.top=n+"px",r.style.height=this._width)}this._layerDiv.style.display="block"},Timeline.PointHighlightDecorator.prototype.softPaint=function(){},Timeline.DetailedEventPainter=function(e){this._params=e,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}},Timeline.DetailedEventPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"},Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(e){this._filterMatcher=e},Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},Timeline.DetailedEventPainter.prototype.paint=function(){var e=this._band.getEventSource();if(null!=e){this._eventIdToElmt={},this._prepareForPainting();for(var t=this._params.theme.event,i=Math.max(t.track.height,this._frc.getLineHeight()),n={trackOffset:Math.round(this._band.getViewWidth()/2-i/2),trackHeight:i,trackGap:t.track.gap,trackIncrement:i+t.track.gap,icon:t.instant.icon,iconWidth:t.instant.iconWidth,iconHeight:t.instant.iconHeight,labelWidth:t.label.width},a=this._band.getMinDate(),r=this._band.getMaxDate(),s=null!=this._filterMatcher?this._filterMatcher:function(e){return!0},l=null!=this._highlightMatcher?this._highlightMatcher:function(e){return-1},o=e.getEventReverseIterator(a,r);o.hasNext();){var h=o.next();s(h)&&this.paintEvent(h,n,this._params.theme,l(h))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,n.trackIncrement)}},Timeline.DetailedEventPainter.prototype.softPaint=function(){},Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var e=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var t=document.createElement("span");t.className="timeline-event-label",this._backLayer.appendChild(t),this._frc=SimileAjax.Graphics.getFontRenderingContext(t)}this._frc.update(),this._lowerTracks=[],this._upperTracks=[],null!=this._highlightLayer&&e.removeLayerDiv(this._highlightLayer),this._highlightLayer=e.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._lineLayer&&e.removeLayerDiv(this._lineLayer),this._lineLayer=e.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",null!=this._eventLayer&&e.removeLayerDiv(this._eventLayer),this._eventLayer=e.createLayerDiv(110,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.DetailedEventPainter.prototype.paintEvent=function(e,t,i,n){e.isInstant()?this.paintInstantEvent(e,t,i,n):this.paintDurationEvent(e,t,i,n)},Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(e,t,i,n){e.isImprecise()?this.paintImpreciseInstantEvent(e,t,i,n):this.paintPreciseInstantEvent(e,t,i,n)},Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(e,t,i,n){e.isImprecise()?this.paintImpreciseDurationEvent(e,t,i,n):this.paintPreciseDurationEvent(e,t,i,n)},Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=Math.round(this._band.dateToPixelOffset(r)),l=Math.round(s+t.iconWidth/2),o=Math.round(s-t.iconWidth/2),h=this._frc.computeSize(a),c=this._findFreeTrackForSolid(l,s),m=this._paintEventIcon(e,c,o,t,i),p=l+i.event.label.offsetFromLine,_=c,u=this._getTrackData(c);Math.min(u.solid,u.text)>=p+h.width?(u.solid=o,u.text=p):(u.solid=o,p=s+i.event.label.offsetFromLine,_=this._findFreeTrackForText(c,p+h.width,function(e){e.line=s-2}),this._getTrackData(_).text=o,this._paintEventLine(e,s,c,_,t,i));var d=Math.round(t.trackOffset+_*t.trackIncrement+t.trackHeight/2-h.height/2),g=this._paintEventLabel(e,a,p,d,h.width,h.height,i),v=this,f=function(t,i,n){return v._onClickInstantEvent(m.elmt,i,e)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",f),SimileAjax.DOM.registerEvent(g.elmt,"mousedown",f),this._createHighlightDiv(n,m,i),this._eventIdToElmt[e.getID()]=m.elmt},Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=e.getEnd(),l=Math.round(this._band.dateToPixelOffset(r)),o=Math.round(this._band.dateToPixelOffset(s)),h=Math.round(l+t.iconWidth/2),c=Math.round(l-t.iconWidth/2),m=this._frc.computeSize(a),p=this._findFreeTrackForSolid(o,l),_=this._paintEventTape(e,p,l,o,i.event.instant.impreciseColor,i.event.instant.impreciseOpacity,t,i),u=this._paintEventIcon(e,p,c,t,i),d=this._getTrackData(p);d.solid=c;var g,v=h+i.event.label.offsetFromLine,f=v+m.width;o>f?g=p:(v=l+i.event.label.offsetFromLine,f=v+m.width,g=this._findFreeTrackForText(p,f,function(e){e.line=l-2}),this._getTrackData(g).text=c,this._paintEventLine(e,l,p,g,t,i));var y=Math.round(t.trackOffset+g*t.trackIncrement+t.trackHeight/2-m.height/2),T=this._paintEventLabel(e,a,v,y,m.width,m.height,i),b=this,E=function(t,i,n){return b._onClickInstantEvent(u.elmt,i,e)};SimileAjax.DOM.registerEvent(u.elmt,"mousedown",E),SimileAjax.DOM.registerEvent(_.elmt,"mousedown",E),SimileAjax.DOM.registerEvent(T.elmt,"mousedown",E),this._createHighlightDiv(n,u,i),this._eventIdToElmt[e.getID()]=u.elmt},Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=e.getEnd(),l=Math.round(this._band.dateToPixelOffset(r)),o=Math.round(this._band.dateToPixelOffset(s)),h=this._frc.computeSize(a),c=this._findFreeTrackForSolid(o),m=e.getColor();m=null!=m?m:i.event.duration.color;var p=this._paintEventTape(e,c,l,o,m,100,t,i),_=this._getTrackData(c);_.solid=l;var u=l+i.event.label.offsetFromLine,d=this._findFreeTrackForText(c,u+h.width,function(e){e.line=l-2});this._getTrackData(d).text=l-2,this._paintEventLine(e,l,c,d,t,i);var g=Math.round(t.trackOffset+d*t.trackIncrement+t.trackHeight/2-h.height/2),v=this._paintEventLabel(e,a,u,g,h.width,h.height,i),f=this,y=function(t,i,n){return f._onClickDurationEvent(p.elmt,i,e)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",y),SimileAjax.DOM.registerEvent(v.elmt,"mousedown",y),this._createHighlightDiv(n,p,i),this._eventIdToElmt[e.getID()]=p.elmt},Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=e.getLatestStart(),l=e.getEnd(),o=e.getEarliestEnd(),h=Math.round(this._band.dateToPixelOffset(r)),c=Math.round(this._band.dateToPixelOffset(s)),m=Math.round(this._band.dateToPixelOffset(l)),p=Math.round(this._band.dateToPixelOffset(o)),_=this._frc.computeSize(a),u=this._findFreeTrackForSolid(m),d=e.getColor();d=null!=d?d:i.event.duration.color;var g=(this._paintEventTape(e,u,h,m,i.event.duration.impreciseColor,i.event.duration.impreciseOpacity,t,i),this._paintEventTape(e,u,c,p,d,100,t,i)),v=this._getTrackData(u);v.solid=h;var f=c+i.event.label.offsetFromLine,y=this._findFreeTrackForText(u,f+_.width,function(e){e.line=c-2});this._getTrackData(y).text=c-2,this._paintEventLine(e,c,u,y,t,i);var T=Math.round(t.trackOffset+y*t.trackIncrement+t.trackHeight/2-_.height/2),b=this._paintEventLabel(e,a,f,T,_.width,_.height,i),E=this,D=function(t,i,n){return E._onClickDurationEvent(g.elmt,i,e)};SimileAjax.DOM.registerEvent(g.elmt,"mousedown",D),SimileAjax.DOM.registerEvent(b.elmt,"mousedown",D),this._createHighlightDiv(n,g,i),this._eventIdToElmt[e.getID()]=g.elmt},Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(e,t){for(var i=0;!0;i++){if(!(i<this._lowerTracks.length))return this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),i;var n=this._lowerTracks[i];if(Math.min(n.solid,n.text)>e&&(!t||n.line>t))return i;if(!(i<this._upperTracks.length))return this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),-1-i;var n=this._upperTracks[i];if(Math.min(n.solid,n.text)>e&&(!t||n.line>t))return-1-i}},Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(e,t,i){var n,a,r,s;if(0>e)n=!0,r=-e,a=this._findFreeUpperTrackForText(r,t),s=-1-a;else if(e>0)n=!1,r=e+1,a=this._findFreeLowerTrackForText(r,t),s=a;else{var l=this._findFreeUpperTrackForText(0,t),o=this._findFreeLowerTrackForText(1,t);l>=o-1?(n=!1,r=1,a=o,s=a):(n=!0,r=0,a=l,s=-1-a)}if(n){a==this._upperTracks.length&&this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(var h=r;a>h;h++)i(this._upperTracks[h])}else{a==this._lowerTracks.length&&this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(var h=r;a>h;h++)i(this._lowerTracks[h])}return s},Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(e,t){for(;e<this._lowerTracks.length;e++){var i=this._lowerTracks[e];if(Math.min(i.solid,i.text)>=t)break}return e},Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(e,t){for(;e<this._upperTracks.length;e++){var i=this._upperTracks[e];if(Math.min(i.solid,i.text)>=t)break}return e},Timeline.DetailedEventPainter.prototype._getTrackData=function(e){return 0>e?this._upperTracks[-e-1]:this._lowerTracks[e]},Timeline.DetailedEventPainter.prototype._paintEventLine=function(e,t,i,n,a,r){var s=Math.round(a.trackOffset+i*a.trackIncrement+a.trackHeight/2),l=Math.round(Math.abs(n-i)*a.trackIncrement),o="1px solid "+r.event.label.lineColor,h=this._timeline.getDocument().createElement("div");h.style.position="absolute",h.style.left=t+"px",h.style.width=r.event.label.offsetFromLine+"px",h.style.height=l+"px",i>n?(h.style.top=s-l+"px",h.style.borderTop=o):(h.style.top=s+"px",h.style.borderBottom=o),h.style.borderLeft=o,this._lineLayer.appendChild(h)},Timeline.DetailedEventPainter.prototype._paintEventIcon=function(e,t,i,n,a){var r=e.getIcon();r=null!=r?r:n.icon;var s=n.trackOffset+t*n.trackIncrement+n.trackHeight/2,l=Math.round(s-n.iconHeight/2),o=SimileAjax.Graphics.createTranslucentImage(r),h=this._timeline.getDocument().createElement("div");return h.style.position="absolute",h.style.left=i+"px",h.style.top=l+"px",h.appendChild(o),h.style.cursor="pointer",null!=e._title&&(h.title=e._title),this._eventLayer.appendChild(h),{left:i,top:l,width:n.iconWidth,height:n.iconHeight,elmt:h}},Timeline.DetailedEventPainter.prototype._paintEventLabel=function(e,t,i,n,a,r,s){var l=this._timeline.getDocument(),o=l.createElement("div");o.style.position="absolute",o.style.left=i+"px",o.style.width=a+"px",o.style.top=n+"px",o.style.height=r+"px",o.style.backgroundColor=s.event.label.backgroundColor,SimileAjax.Graphics.setOpacity(o,s.event.label.backgroundOpacity),this._eventLayer.appendChild(o);var h=l.createElement("div");h.style.position="absolute",h.style.left=i+"px",h.style.width=a+"px",h.style.top=n+"px",h.innerHTML=t,h.style.cursor="pointer",null!=e._title&&(h.title=e._title);var c=e.getTextColor();return null==c&&(c=e.getColor()),null!=c&&(h.style.color=c),this._eventLayer.appendChild(h),{left:i,top:n,width:a,height:r,elmt:h}},Timeline.DetailedEventPainter.prototype._paintEventTape=function(e,t,i,n,a,r,s,l){var o=n-i,h=l.event.tape.height,c=s.trackOffset+t*s.trackIncrement+s.trackHeight/2,m=Math.round(c-h/2),p=this._timeline.getDocument().createElement("div");return p.style.position="absolute",p.style.left=i+"px",p.style.width=o+"px",p.style.top=m+"px",p.style.height=h+"px",p.style.backgroundColor=a,p.style.overflow="hidden",p.style.cursor="pointer",null!=e._title&&(p.title=e._title),SimileAjax.Graphics.setOpacity(p,r),this._eventLayer.appendChild(p),{left:i,top:m,width:o,height:h,elmt:p}},Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(e,t,i){if(e>=0){var n=this._timeline.getDocument(),a=i.event,r=a.highlightColors[Math.min(e,a.highlightColors.length-1)],s=n.createElement("div");s.style.position="absolute",s.style.overflow="hidden",s.style.left=t.left-2+"px",s.style.width=t.width+4+"px",s.style.top=t.top-2+"px",s.style.height=t.height+4+"px",s.style.background=r,this._highlightLayer.appendChild(s)}},Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(e,t,i){var n=SimileAjax.DOM.getPageCoordinates(e);return this._showBubble(n.left+Math.ceil(e.offsetWidth/2),n.top+Math.ceil(e.offsetHeight/2),i),this._fireOnSelect(i.getID()),t.cancelBubble=!0,SimileAjax.DOM.cancelEvent(t),!1},Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(e,t,i){if("pageX"in t)var n=t.pageX,a=t.pageY;else var r=SimileAjax.DOM.getPageCoordinates(e),n=t.offsetX+r.left,a=t.offsetY+r.top;return this._showBubble(n,a,i),this._fireOnSelect(i.getID()),t.cancelBubble=!0,SimileAjax.DOM.cancelEvent(t),!1},Timeline.DetailedEventPainter.prototype.showBubble=function(e){var t=this._eventIdToElmt[e.getID()];if(t){var i=SimileAjax.DOM.getPageCoordinates(t);this._showBubble(i.left+t.offsetWidth/2,i.top+t.offsetHeight/2,e)}},Timeline.DetailedEventPainter.prototype._showBubble=function(e,t,i){var n=document.createElement("div"),a=this._params.theme.event.bubble;i.fillInfoBubble(n,this._params.theme,this._band.getLabeller()),SimileAjax.WindowManager.cancelPopups(),SimileAjax.Graphics.createBubbleForContentAndPoint(n,e,t,a.width,null,a.maxHeight)},Timeline.DetailedEventPainter.prototype._fireOnSelect=function(e){for(var t=0;t<this._onSelectListeners.length;t++)this._onSelectListeners[t](e)},Timeline.GregorianEtherPainter=function(e){this._params=e,this._theme=e.theme,this._unit=e.unit,this._multiple="multiple"in e?e.multiple:1},Timeline.GregorianEtherPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[t.isHorizontal()?"hAlign":"vAlign"],n="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,i,n),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.GregorianEtherPainter.prototype.setHighlight=function(e,t){this._highlight.position(e,t)},Timeline.GregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var e=this._band.getMinDate(),t=this._band.getMaxDate(),i=this._band.getTimeZone(),n=this._band.getLabeller();SimileAjax.DateTime.roundDownToInterval(e,this._unit,i,this._multiple,this._theme.firstDayOfWeek);for(var a=this,r=function(e){for(var t=0;t<a._multiple;t++)SimileAjax.DateTime.incrementByInterval(e,a._unit)};e.getTime()<t.getTime();)this._intervalMarkerLayout.createIntervalMarker(e,n,this._unit,this._markerLayer,this._lineLayer),r(e);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.GregorianEtherPainter.prototype.softPaint=function(){},Timeline.GregorianEtherPainter.prototype.zoom=function(e){0!=e&&(this._unit+=e)},Timeline.HotZoneGregorianEtherPainter=function(e){this._params=e,this._theme=e.theme,this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:e.unit,multiple:1}];for(var t=0;t<e.zones.length;t++)for(var i=e.zones[t],n=SimileAjax.DateTime.parseGregorianDateTime(i.start).getTime(),a=SimileAjax.DateTime.parseGregorianDateTime(i.end).getTime(),r=0;r<this._zones.length&&a>n;r++){var s=this._zones[r];n<s.endTime&&(n>s.startTime&&(this._zones.splice(r,0,{startTime:s.startTime,endTime:n,unit:s.unit,multiple:s.multiple}),r++,s.startTime=n),a<s.endTime?(this._zones.splice(r,0,{startTime:n,endTime:a,unit:i.unit,multiple:i.multiple?i.multiple:1}),r++,s.startTime=a,n=a):(s.multiple=i.multiple,s.unit=i.unit,n=s.endTime))}},Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[t.isHorizontal()?"hAlign":"vAlign"],n="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,i,n),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(e,t){this._highlight.position(e,t)},Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";for(var e=this._band.getMinDate(),t=this._band.getMaxDate(),i=this._band.getTimeZone(),n=this._band.getLabeller(),a=function(e,t){for(var i=0;i<t.multiple;i++)SimileAjax.DateTime.incrementByInterval(e,t.unit)},r=0;r<this._zones.length&&!(e.getTime()<this._zones[r].endTime);)r++;for(var s=this._zones.length-1;s>=0&&!(t.getTime()>this._zones[s].startTime);)s--;for(var l=r;s>=l;l++){var o=this._zones[l],h=new Date(Math.max(e.getTime(),o.startTime)),c=new Date(Math.min(t.getTime(),o.endTime));for(SimileAjax.DateTime.roundDownToInterval(h,o.unit,i,o.multiple,this._theme.firstDayOfWeek),SimileAjax.DateTime.roundUpToInterval(c,o.unit,i,o.multiple,this._theme.firstDayOfWeek);h.getTime()<c.getTime();)this._intervalMarkerLayout.createIntervalMarker(h,n,o.unit,this._markerLayer,this._lineLayer),a(h,o)}this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){},Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(e){if(0!=e)for(var t=0;t<this._zones.length;++t)this._zones[t]&&(this._zones[t].unit+=e)},Timeline.YearCountEtherPainter=function(e){this._params=e,this._theme=e.theme,this._startDate=SimileAjax.DateTime.parseGregorianDateTime(e.startDate),this._multiple="multiple"in e?e.multiple:1},Timeline.YearCountEtherPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params?this._params.align:this._theme.ether.interval.marker[t.isHorizontal()?"hAlign":"vAlign"],n="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,i,n),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.YearCountEtherPainter.prototype.setHighlight=function(e,t){this._highlight.position(e,t)},Timeline.YearCountEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var e=new Date(this._startDate.getTime()),t=this._band.getMaxDate(),i=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();e.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-i%this._multiple);for(var n=this,a=function(e){for(var t=0;t<n._multiple;t++)SimileAjax.DateTime.incrementByInterval(e,SimileAjax.DateTime.YEAR)},r={labelInterval:function(e,t){var i=e.getUTCFullYear()-n._startDate.getUTCFullYear();return{text:i,emphasized:0==i}}};e.getTime()<t.getTime();)this._intervalMarkerLayout.createIntervalMarker(e,r,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),a(e);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.YearCountEtherPainter.prototype.softPaint=function(){},Timeline.QuarterlyEtherPainter=function(e){this._params=e,this._theme=e.theme,this._startDate=SimileAjax.DateTime.parseGregorianDateTime(e.startDate)},Timeline.QuarterlyEtherPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params?this._params.align:this._theme.ether.interval.marker[t.isHorizontal()?"hAlign":"vAlign"],n="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,i,n),this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)},Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(e,t){this._highlight.position(e,t)},Timeline.QuarterlyEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var e=new Date(0),t=this._band.getMaxDate();e.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear())),e.setUTCMonth(this._startDate.getUTCMonth());for(var i=this,n=function(e){e.setUTCMonth(e.getUTCMonth()+3)},a={labelInterval:function(e,t){var n=(4+(e.getUTCMonth()-i._startDate.getUTCMonth())/3)%4;return 0!=n?{text:"Q"+(n+1),emphasized:!1}:{text:"Y"+(e.getUTCFullYear()-i._startDate.getUTCFullYear()+1),emphasized:!0}}};e.getTime()<t.getTime();)this._intervalMarkerLayout.createIntervalMarker(e,a,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),n(e);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){},Timeline.EtherIntervalMarkerLayout=function(e,t,i,n,a){var r=e.isHorizontal();r?"Top"==n?this.positionDiv=function(e,t){e.style.left=t+"px",e.style.top="0px"}:this.positionDiv=function(e,t){e.style.left=t+"px",e.style.bottom="0px"}:"Left"==n?this.positionDiv=function(e,t){e.style.top=t+"px",e.style.left="0px"}:this.positionDiv=function(e,t){e.style.top=t+"px",e.style.right="0px"};var s=i.ether.interval.marker,l=i.ether.interval.line,o=i.ether.interval.weekend,h=(r?"h":"v")+n,c=(s[h+"Styler"],s[h+"EmphasizedStyler"],SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY]);this.createIntervalMarker=function(n,s,h,m,p){var _=Math.round(t.dateToPixelOffset(n));if(a&&h!=SimileAjax.DateTime.WEEK){var u=e.getDocument().createElement("div");u.className="timeline-ether-lines",l.opacity<100&&SimileAjax.Graphics.setOpacity(u,l.opacity),r?u.style.left=_+"px":u.style.top=_+"px",p.appendChild(u)}if(h==SimileAjax.DateTime.WEEK){var d=i.firstDayOfWeek,g=new Date(n.getTime()+(6-d-7)*c),v=new Date(g.getTime()+2*c),f=Math.round(t.dateToPixelOffset(g)),y=Math.round(t.dateToPixelOffset(v)),T=Math.max(1,y-f),b=e.getDocument().createElement("div");b.className="timeline-ether-weekends",o.opacity<100&&SimileAjax.Graphics.setOpacity(b,o.opacity),r?(b.style.left=f+"px",b.style.width=T+"px"):(b.style.top=f+"px",b.style.height=T+"px"),p.appendChild(b)}var E=s.labelInterval(n,h),D=e.getDocument().createElement("div");return D.innerHTML=E.text,D.className="timeline-date-label",E.emphasized&&(D.className+=" timeline-date-label-em"),this.positionDiv(D,_),m.appendChild(D),D}},Timeline.EtherHighlight=function(e,t,i,n){var a=e.isHorizontal();this._highlightDiv=null,this._createHighlightDiv=function(){if(null==this._highlightDiv){this._highlightDiv=e.getDocument().createElement("div"),this._highlightDiv.setAttribute("name","ether-highlight"),this._highlightDiv.className="timeline-ether-highlight";var t=i.ether.highlightOpacity;100>t&&SimileAjax.Graphics.setOpacity(this._highlightDiv,t),n.appendChild(this._highlightDiv)}},this.position=function(e,i){this._createHighlightDiv();var n=Math.round(t.dateToPixelOffset(e)),r=Math.round(t.dateToPixelOffset(i)),s=Math.max(r-n,3);a?(this._highlightDiv.style.left=n+"px",this._highlightDiv.style.width=s+"px",this._highlightDiv.style.height=t.getViewWidth()-4+"px"):(this._highlightDiv.style.top=n+"px",this._highlightDiv.style.height=s+"px",this._highlightDiv.style.width=t.getViewWidth()-4+"px")}},Timeline.LinearEther=function(e){this._params=e,this._interval=e.interval,this._pixelsPerInterval=e.pixelsPerInterval},Timeline.LinearEther.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._unit=t.getUnit(),"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):"centersOn"in this._params?(this._start=this._unit.parseFromObject(this._params.centersOn),this.shiftPixels(-this._timeline.getPixelLength()/2)):(this._start=this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))},Timeline.LinearEther.prototype.setDate=function(e){this._start=this._unit.cloneValue(e)},Timeline.LinearEther.prototype.shiftPixels=function(e){var t=this._interval*e/this._pixelsPerInterval;this._start=this._unit.change(this._start,t)},Timeline.LinearEther.prototype.dateToPixelOffset=function(e){var t=this._unit.compare(e,this._start);return this._pixelsPerInterval*t/this._interval},Timeline.LinearEther.prototype.pixelOffsetToDate=function(e){var t=e*this._interval/this._pixelsPerInterval;return this._unit.change(this._start,t)},Timeline.LinearEther.prototype.zoom=function(e){var t=0,i=this._band._zoomIndex,n=i;return e&&i>0&&(n=i-1),!e&&i<this._band._zoomSteps.length-1&&(n=i+1),this._band._zoomIndex=n,this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[n].unit],this._pixelsPerInterval=this._band._zoomSteps[n].pixelsPerInterval,t=this._band._zoomSteps[n].unit-this._band._zoomSteps[i].unit},Timeline.HotZoneEther=function(e){this._params=e,this._interval=e.interval,this._pixelsPerInterval=e.pixelsPerInterval,this._theme=e.theme},Timeline.HotZoneEther.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._unit=t.getUnit(),this._zones=[{startTime:Number.NEGATIVE_INFINITY,
endTime:Number.POSITIVE_INFINITY,magnify:1}];for(var i=this._params,n=0;n<i.zones.length;n++)for(var a=i.zones[n],r=this._unit.parseFromObject(a.start),s=this._unit.parseFromObject(a.end),l=0;l<this._zones.length&&this._unit.compare(s,r)>0;l++){var o=this._zones[l];this._unit.compare(r,o.endTime)<0&&(this._unit.compare(r,o.startTime)>0&&(this._zones.splice(l,0,{startTime:o.startTime,endTime:r,magnify:o.magnify}),l++,o.startTime=r),this._unit.compare(s,o.endTime)<0?(this._zones.splice(l,0,{startTime:r,endTime:s,magnify:a.magnify*o.magnify}),l++,o.startTime=s,r=s):(o.magnify*=a.magnify,r=o.endTime))}"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):"centersOn"in this._params?(this._start=this._unit.parseFromObject(this._params.centersOn),this.shiftPixels(-this._timeline.getPixelLength()/2)):(this._start=this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))},Timeline.HotZoneEther.prototype.setDate=function(e){this._start=this._unit.cloneValue(e)},Timeline.HotZoneEther.prototype.shiftPixels=function(e){this._start=this.pixelOffsetToDate(e)},Timeline.HotZoneEther.prototype.dateToPixelOffset=function(e){return this._dateDiffToPixelOffset(this._start,e)},Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(e){return this._pixelOffsetToDate(e,this._start)},Timeline.HotZoneEther.prototype.zoom=function(e){var t=0,i=this._band._zoomIndex,n=i;return e&&i>0&&(n=i-1),!e&&i<this._band._zoomSteps.length-1&&(n=i+1),this._band._zoomIndex=n,this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[n].unit],this._pixelsPerInterval=this._band._zoomSteps[n].pixelsPerInterval,t=this._band._zoomSteps[n].unit-this._band._zoomSteps[i].unit},Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(e,t){var i=this._getScale(),n=e,a=t,r=0;if(this._unit.compare(n,a)<0){for(var s=0;s<this._zones.length&&!(this._unit.compare(n,this._zones[s].endTime)<0);)s++;for(;this._unit.compare(n,a)<0;){var l=this._zones[s],o=this._unit.earlier(a,l.endTime);r+=this._unit.compare(o,n)/(i/l.magnify),n=o,s++}}else{for(var s=this._zones.length-1;s>=0&&!(this._unit.compare(n,this._zones[s].startTime)>0);)s--;for(;this._unit.compare(n,a)>0;){var l=this._zones[s],o=this._unit.later(a,l.startTime);r+=this._unit.compare(o,n)/(i/l.magnify),n=o,s--}}return r},Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(e,t){var i=this._getScale(),n=t;if(e>0){for(var a=0;a<this._zones.length&&!(this._unit.compare(n,this._zones[a].endTime)<0);)a++;for(;e>0;){var r=this._zones[a],s=i/r.magnify;if(r.endTime==Number.POSITIVE_INFINITY)n=this._unit.change(n,e*s),e=0;else{var l=this._unit.compare(r.endTime,n)/s;l>e?(n=this._unit.change(n,e*s),e=0):(n=r.endTime,e-=l)}a++}}else{for(var a=this._zones.length-1;a>=0&&!(this._unit.compare(n,this._zones[a].startTime)>0);)a--;for(e=-e;e>0;){var r=this._zones[a],s=i/r.magnify;if(r.startTime==Number.NEGATIVE_INFINITY)n=this._unit.change(n,-e*s),e=0;else{var l=this._unit.compare(n,r.startTime)/s;l>e?(n=this._unit.change(n,-e*s),e=0):(n=r.startTime,e-=l)}a--}}return n},Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval},Timeline.EventUtils={},Timeline.EventUtils.getNewEventID=function(){return null==this._lastEventID&&(this._lastEventID=0),this._lastEventID+=1,"e"+this._lastEventID},Timeline.EventUtils.decodeEventElID=function(e){var t=e.split("-");if("tl"!=t[1])return alert("Internal Timeline problem 101, please consult support"),{band:null,evt:null};var i=Timeline.getTimelineFromID(t[2]),n=i.getBand(t[3]),a=n.getEventSource.getEvent(t[4]);return{band:n,evt:a}},Timeline.EventUtils.encodeEventElID=function(e,t,i,n){return i+"-tl-"+e.timelineID+"-"+t.getIndex()+"-"+n.getID()},Timeline.GregorianDateLabeller=function(e,t){this._locale=e,this._timeZone=t},Timeline.GregorianDateLabeller.monthNames=[],Timeline.GregorianDateLabeller.dayNames=[],Timeline.GregorianDateLabeller.labelIntervalFunctions=[],Timeline.GregorianDateLabeller.getMonthName=function(e,t){return Timeline.GregorianDateLabeller.monthNames[t][e]},Timeline.GregorianDateLabeller.prototype.labelInterval=function(e,t){var i=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];return null==i&&(i=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval),i.call(this,e,t)},Timeline.GregorianDateLabeller.prototype.labelPrecise=function(e){return SimileAjax.DateTime.removeTimeZoneOffset(e,this._timeZone).toUTCString()},Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(e,t){var i,n=!1;switch(e=SimileAjax.DateTime.removeTimeZoneOffset(e,this._timeZone),t){case SimileAjax.DateTime.MILLISECOND:i=e.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:i=e.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:var a=e.getUTCMinutes();0==a?(i=e.getUTCHours()+":00",n=!0):i=a;break;case SimileAjax.DateTime.HOUR:i=e.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:i=Timeline.GregorianDateLabeller.getMonthName(e.getUTCMonth(),this._locale)+"<br />"+e.getUTCDate();break;case SimileAjax.DateTime.WEEK:i=Timeline.GregorianDateLabeller.getMonthName(e.getUTCMonth(),this._locale)+" "+e.getUTCDate();break;case SimileAjax.DateTime.MONTH:var a=e.getUTCMonth();i=Timeline.GregorianDateLabeller.getMonthName(a,this._locale),0==a&&(i+="<br />"+e.getUTCFullYear());break;case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:var r=e.getUTCFullYear();i=r>0?e.getUTCFullYear():1-r+"BC",n=t==SimileAjax.DateTime.MONTH||t==SimileAjax.DateTime.DECADE&&r%100==0||t==SimileAjax.DateTime.CENTURY&&r%1e3==0;break;default:i=e.toUTCString()}return{text:i,emphasized:n}},Timeline.OriginalEventPainter=function(e){this._params=e,this._onSelectListeners=[],this._eventPaintListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}},Timeline.OriginalEventPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},Timeline.OriginalEventPainter.prototype.getType=function(){return"original"},Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(e){this._eventPaintListeners.push(e)},Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(e){for(var t=0;t<this._eventPaintListeners.length;t++)if(this._eventPaintListeners[t]==e){this._eventPaintListeners.splice(t,1);break}},Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(e){this._filterMatcher=e},Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},Timeline.OriginalEventPainter.prototype.paint=function(){var e=this._band.getEventSource();if(null!=e){this._eventIdToElmt={},this._fireEventPaintListeners("paintStarting",null,null),this._prepareForPainting();for(var t=this._params.theme.event,i=Math.max(t.track.height,t.tape.height+this._frc.getLineHeight()),n={trackOffset:t.track.offset,trackHeight:i,trackGap:t.track.gap,trackIncrement:i+t.track.gap,icon:t.instant.icon,iconWidth:t.instant.iconWidth,iconHeight:t.instant.iconHeight,labelWidth:t.label.width,maxLabelChar:t.label.maxLabelChar,impreciseIconMargin:t.instant.impreciseIconMargin},a=this._band.getMinDate(),r=this._band.getMaxDate(),s=null!=this._filterMatcher?this._filterMatcher:function(e){return!0},l=null!=this._highlightMatcher?this._highlightMatcher:function(e){return-1},o=e.getEventReverseIterator(a,r);o.hasNext();){var h=o.next();s(h)&&this.paintEvent(h,n,this._params.theme,l(h))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._tracks.length,n.trackIncrement),this._fireEventPaintListeners("paintEnded",null,null)}},Timeline.OriginalEventPainter.prototype.softPaint=function(){},Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var e=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var t=document.createElement("span");t.className="timeline-event-label",this._backLayer.appendChild(t),this._frc=SimileAjax.Graphics.getFontRenderingContext(t)}this._frc.update(),this._tracks=[],null!=this._highlightLayer&&e.removeLayerDiv(this._highlightLayer),this._highlightLayer=e.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._lineLayer&&e.removeLayerDiv(this._lineLayer),this._lineLayer=e.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",null!=this._eventLayer&&e.removeLayerDiv(this._eventLayer),this._eventLayer=e.createLayerDiv(115,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.OriginalEventPainter.prototype.paintEvent=function(e,t,i,n){e.isInstant()?this.paintInstantEvent(e,t,i,n):this.paintDurationEvent(e,t,i,n)},Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(e,t,i,n){e.isImprecise()?this.paintImpreciseInstantEvent(e,t,i,n):this.paintPreciseInstantEvent(e,t,i,n)},Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(e,t,i,n){e.isImprecise()?this.paintImpreciseDurationEvent(e,t,i,n):this.paintPreciseDurationEvent(e,t,i,n)},Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=Math.round(this._band.dateToPixelOffset(r)),l=Math.round(s+t.iconWidth/2),o=Math.round(s-t.iconWidth/2),h=this._getLabelDivClassName(e),c=this._frc.computeSize(a,h),m=l+i.event.label.offsetFromLine,p=m+c.width,_=p,u=this._findFreeTrack(e,_),d=Math.round(t.trackOffset+u*t.trackIncrement+t.trackHeight/2-c.height/2),g=this._paintEventIcon(e,u,o,t,i,0),v=this._paintEventLabel(e,a,m,d,c.width,c.height,i,h,n),f=[g.elmt,v.elmt],y=this,T=function(t,i,n){return y._onClickInstantEvent(g.elmt,i,e)};SimileAjax.DOM.registerEvent(g.elmt,"mousedown",T),SimileAjax.DOM.registerEvent(v.elmt,"mousedown",T);var b=this._createHighlightDiv(n,g,i,e);null!=b&&f.push(b),this._fireEventPaintListeners("paintedEvent",e,f),this._eventIdToElmt[e.getID()]=g.elmt,this._tracks[u]=o},Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=e.getEnd(),l=Math.round(this._band.dateToPixelOffset(r)),o=Math.round(this._band.dateToPixelOffset(s)),h=Math.round(l+t.iconWidth/2),c=Math.round(l-t.iconWidth/2),m=this._getLabelDivClassName(e),p=this._frc.computeSize(a,m),_=h+i.event.label.offsetFromLine,u=_+p.width,d=Math.max(u,o),g=this._findFreeTrack(e,d),v=i.event.tape.height,f=Math.round(t.trackOffset+g*t.trackIncrement+v),y=this._paintEventIcon(e,g,c,t,i,v),T=this._paintEventLabel(e,a,_,f,p.width,p.height,i,m,n),b=e.getColor();b=null!=b?b:i.event.instant.impreciseColor;var E=this._paintEventTape(e,g,l,o,b,i.event.instant.impreciseOpacity,t,i,0),D=[y.elmt,T.elmt,E.elmt],L=this,x=function(t,i,n){return L._onClickInstantEvent(y.elmt,i,e)};SimileAjax.DOM.registerEvent(y.elmt,"mousedown",x),SimileAjax.DOM.registerEvent(E.elmt,"mousedown",x),SimileAjax.DOM.registerEvent(T.elmt,"mousedown",x);var I=this._createHighlightDiv(n,y,i,e);null!=I&&D.push(I),this._fireEventPaintListeners("paintedEvent",e,D),this._eventIdToElmt[e.getID()]=y.elmt,this._tracks[g]=c},Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=e.getEnd(),l=Math.round(this._band.dateToPixelOffset(r)),o=Math.round(this._band.dateToPixelOffset(s)),h=this._getLabelDivClassName(e),c=this._frc.computeSize(a,h),m=l,p=m+c.width,_=Math.max(p,o),u=this._findFreeTrack(e,_),d=Math.round(t.trackOffset+u*t.trackIncrement),g=e.getColor();g=null!=g?g:i.event.duration.color;var v=this._paintEventTape(e,u,l,o,g,100,t,i,0),f=this._paintEventLabel(e,a,m,d,c.width,c.height,i,h,n),y=[v.elmt,f.elmt],T=this,b=function(t,i,n){return T._onClickDurationEvent(v.elmt,i,e)};SimileAjax.DOM.registerEvent(v.elmt,"mousedown",b),SimileAjax.DOM.registerEvent(f.elmt,"mousedown",b);var E=this._createHighlightDiv(n,v,i,e);null!=E&&y.push(E),this._fireEventPaintListeners("paintedEvent",e,y),this._eventIdToElmt[e.getID()]=v.elmt,this._tracks[u]=l},Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(e,t,i,n){var a=(this._timeline.getDocument(),e.getText()),r=e.getStart(),s=e.getLatestStart(),l=e.getEnd(),o=e.getEarliestEnd(),h=Math.round(this._band.dateToPixelOffset(r)),c=Math.round(this._band.dateToPixelOffset(s)),m=Math.round(this._band.dateToPixelOffset(l)),p=Math.round(this._band.dateToPixelOffset(o)),_=this._getLabelDivClassName(e),u=this._frc.computeSize(a,_),d=c,g=d+u.width,v=Math.max(g,m),f=this._findFreeTrack(e,v),y=Math.round(t.trackOffset+f*t.trackIncrement+i.event.tape.height),T=e.getColor();T=null!=T?T:i.event.duration.color;var b=this._paintEventTape(e,f,h,m,i.event.duration.impreciseColor,i.event.duration.impreciseOpacity,t,i,0),E=this._paintEventTape(e,f,c,p,T,100,t,i,1),D=this._paintEventLabel(e,a,d,y,u.width,u.height,i,_,n),L=[b.elmt,E.elmt,D.elmt],x=this,I=function(t,i,n){return x._onClickDurationEvent(E.elmt,i,e)};SimileAjax.DOM.registerEvent(E.elmt,"mousedown",I),SimileAjax.DOM.registerEvent(D.elmt,"mousedown",I);var k=this._createHighlightDiv(n,E,i,e);null!=k&&L.push(k),this._fireEventPaintListeners("paintedEvent",e,L),this._eventIdToElmt[e.getID()]=E.elmt,this._tracks[f]=h},Timeline.OriginalEventPainter.prototype._encodeEventElID=function(e,t){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,e,t)},Timeline.OriginalEventPainter.prototype._findFreeTrack=function(e,t){var i=e.getTrackNum();if(null!=i)return i;for(var n=0;n<this._tracks.length;n++){var a=this._tracks[n];if(a>t)break}return n},Timeline.OriginalEventPainter.prototype._paintEventIcon=function(e,t,i,n,a,r){var s=e.getIcon();s=null!=s?s:n.icon;var l;if(r>0)l=n.trackOffset+t*n.trackIncrement+r+n.impreciseIconMargin;else{var o=n.trackOffset+t*n.trackIncrement+n.trackHeight/2;l=Math.round(o-n.iconHeight/2)}var h=SimileAjax.Graphics.createTranslucentImage(s),c=this._timeline.getDocument().createElement("div");return c.className=this._getElClassName("timeline-event-icon",e,"icon"),c.id=this._encodeEventElID("icon",e),c.style.left=i+"px",c.style.top=l+"px",c.appendChild(h),null!=e._title&&(c.title=e._title),this._eventLayer.appendChild(c),{left:i,top:l,width:n.iconWidth,height:n.iconHeight,elmt:c}},Timeline.OriginalEventPainter.prototype._paintEventLabel=function(e,t,i,n,a,r,s,l,o){var h=this._timeline.getDocument(),c=h.createElement("div");c.className=l,c.id=this._encodeEventElID("label",e),c.style.left=i+"px",c.style.width=a+"px",c.style.top=n+"px",c.innerHTML=t,null!=e._title&&(c.title=e._title);var m=e.getTextColor();return null==m&&(m=e.getColor()),null!=m&&(c.style.color=m),s.event.highlightLabelBackground&&o>=0&&(c.style.background=this._getHighlightColor(o,s)),this._eventLayer.appendChild(c),{left:i,top:n,width:a,height:r,elmt:c}},Timeline.OriginalEventPainter.prototype._paintEventTape=function(e,t,i,n,a,r,s,l,o){var h=n-i,c=l.event.tape.height,m=s.trackOffset+t*s.trackIncrement,p=this._timeline.getDocument().createElement("div");p.className=this._getElClassName("timeline-event-tape",e,"tape"),p.id=this._encodeEventElID("tape"+o,e),p.style.left=i+"px",p.style.width=h+"px",p.style.height=c+"px",p.style.top=m+"px",null!=e._title&&(p.title=e._title),null!=a&&(p.style.backgroundColor=a);var _=e.getTapeImage(),u=e.getTapeRepeat();return u=null!=u?u:"repeat",null!=_&&(p.style.backgroundImage="url("+_+")",p.style.backgroundRepeat=u),SimileAjax.Graphics.setOpacity(p,r),this._eventLayer.appendChild(p),{left:i,top:m,width:h,height:c,elmt:p}},Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(e){return this._getElClassName("timeline-event-label",e,"label")},Timeline.OriginalEventPainter.prototype._getElClassName=function(e,t,i){var n=t.getClassName(),a=[];return n&&(i&&a.push(i+"-"+n+" "),a.push(n+" ")),a.push(e),a.join("")},Timeline.OriginalEventPainter.prototype._getHighlightColor=function(e,t){var i=t.event.highlightColors;return i[Math.min(e,i.length-1)]},Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(e,t,i,n){var a=null;if(e>=0){var r=this._timeline.getDocument(),s=this._getHighlightColor(e,i);a=r.createElement("div"),a.className=this._getElClassName("timeline-event-highlight",n,"highlight"),a.id=this._encodeEventElID("highlight0",n),a.style.position="absolute",a.style.overflow="hidden",a.style.left=t.left-2+"px",a.style.width=t.width+4+"px",a.style.top=t.top-2+"px",a.style.height=t.height+4+"px",a.style.background=s,this._highlightLayer.appendChild(a)}return a},Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(e,t,i){var n=SimileAjax.DOM.getPageCoordinates(e);return this._showBubble(n.left+Math.ceil(e.offsetWidth/2),n.top+Math.ceil(e.offsetHeight/2),i),this._fireOnSelect(i.getID()),t.cancelBubble=!0,SimileAjax.DOM.cancelEvent(t),!1},Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(e,t,i){if("pageX"in t)var n=t.pageX,a=t.pageY;else var r=SimileAjax.DOM.getPageCoordinates(e),n=t.offsetX+r.left,a=t.offsetY+r.top;return this._showBubble(n,a,i),this._fireOnSelect(i.getID()),t.cancelBubble=!0,SimileAjax.DOM.cancelEvent(t),!1},Timeline.OriginalEventPainter.prototype.showBubble=function(e){var t=this._eventIdToElmt[e.getID()];if(t){var i=SimileAjax.DOM.getPageCoordinates(t);this._showBubble(i.left+t.offsetWidth/2,i.top+t.offsetHeight/2,e)}},Timeline.OriginalEventPainter.prototype._showBubble=function(e,t,i){var n=document.createElement("div"),a=this._params.theme.event.bubble;i.fillInfoBubble(n,this._params.theme,this._band.getLabeller()),SimileAjax.WindowManager.cancelPopups(),SimileAjax.Graphics.createBubbleForContentAndPoint(n,e,t,a.width,null,a.maxHeight)},Timeline.OriginalEventPainter.prototype._fireOnSelect=function(e){for(var t=0;t<this._onSelectListeners.length;t++)this._onSelectListeners[t](e)},Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(e,t,i){for(var n=0;n<this._eventPaintListeners.length;n++)this._eventPaintListeners[n](this._band,e,t,i)},Timeline.OverviewEventPainter=function(e){this._params=e,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null},Timeline.OverviewEventPainter.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._eventLayer=null,this._highlightLayer=null},Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"},Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher},Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(e){this._filterMatcher=e},Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher},Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},Timeline.OverviewEventPainter.prototype.paint=function(){var e=this._band.getEventSource();if(null!=e){this._prepareForPainting();for(var t=this._params.theme.event,i={trackOffset:t.overviewTrack.offset,trackHeight:t.overviewTrack.height,trackGap:t.overviewTrack.gap,trackIncrement:t.overviewTrack.height+t.overviewTrack.gap},n=this._band.getMinDate(),a=this._band.getMaxDate(),r=null!=this._filterMatcher?this._filterMatcher:function(e){return!0},s=null!=this._highlightMatcher?this._highlightMatcher:function(e){return-1},l=e.getEventReverseIterator(n,a);l.hasNext();){var o=l.next();r(o)&&this.paintEvent(o,i,this._params.theme,s(o))}this._highlightLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._tracks.length,i.trackIncrement)}},Timeline.OverviewEventPainter.prototype.softPaint=function(){},Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var e=this._band;this._tracks=[],null!=this._highlightLayer&&e.removeLayerDiv(this._highlightLayer),this._highlightLayer=e.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",null!=this._eventLayer&&e.removeLayerDiv(this._eventLayer),this._eventLayer=e.createLayerDiv(110,"timeline-band-events"),this._eventLayer.style.display="none"},Timeline.OverviewEventPainter.prototype.paintEvent=function(e,t,i,n){e.isInstant()?this.paintInstantEvent(e,t,i,n):this.paintDurationEvent(e,t,i,n)},Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(e,t,i,n){var a=e.getStart(),r=Math.round(this._band.dateToPixelOffset(a)),s=e.getColor(),l=e.getClassName();s=l?null:null!=s?s:i.event.duration.color;var o=this._paintEventTick(e,r,s,100,t,i);this._createHighlightDiv(n,o,i)},Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(e,t,i,n){for(var a=e.getLatestStart(),r=e.getEarliestEnd(),s=Math.round(this._band.dateToPixelOffset(a)),l=Math.round(this._band.dateToPixelOffset(r)),o=0;o<this._tracks.length&&!(l<this._tracks[o]);o++);this._tracks[o]=l;var h=e.getColor(),c=e.getClassName();h=c?null:null!=h?h:i.event.duration.color;var m=this._paintEventTape(e,o,s,l,h,100,t,i,c);this._createHighlightDiv(n,m,i)},Timeline.OverviewEventPainter.prototype._paintEventTape=function(e,t,i,n,a,r,s,l,o){var h=s.trackOffset+t*s.trackIncrement,c=n-i,m=s.trackHeight,p=this._timeline.getDocument().createElement("div");return p.className="timeline-small-event-tape",o&&(p.className+=" small-"+o),p.style.left=i+"px",p.style.width=c+"px",p.style.top=h+"px",p.style.height=m+"px",a&&(p.style.backgroundColor=a),100>r&&SimileAjax.Graphics.setOpacity(p,r),this._eventLayer.appendChild(p),{left:i,top:h,width:c,height:m,elmt:p}},Timeline.OverviewEventPainter.prototype._paintEventTick=function(e,t,i,n,a,r){var s=r.event.overviewTrack.tickHeight,l=a.trackOffset-s,o=1,h=this._timeline.getDocument().createElement("div");h.className="timeline-small-event-icon",h.style.left=t+"px",h.style.top=l+"px";var c=e.getClassName();return c&&(h.className+=" small-"+c),100>n&&SimileAjax.Graphics.setOpacity(h,n),this._eventLayer.appendChild(h),{left:t,top:l,width:o,height:s,elmt:h}},Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(e,t,i){if(e>=0){var n=this._timeline.getDocument(),a=i.event,r=a.highlightColors[Math.min(e,a.highlightColors.length-1)],s=n.createElement("div");s.style.position="absolute",s.style.overflow="hidden",s.style.left=t.left-1+"px",s.style.width=t.width+2+"px",s.style.top=t.top-1+"px",s.style.height=t.height+2+"px",s.style.background=r,this._highlightLayer.appendChild(s)}},Timeline.OverviewEventPainter.prototype.showBubble=function(e){},Timeline.DefaultEventSource=function(e){this._events=e instanceof Object?e:new SimileAjax.EventIndex,this._listeners=[]},Timeline.DefaultEventSource.prototype.addListener=function(e){this._listeners.push(e)},Timeline.DefaultEventSource.prototype.removeListener=function(e){for(var t=0;t<this._listeners.length;t++)if(this._listeners[t]==e){this._listeners.splice(t,1);break}},Timeline.DefaultEventSource.prototype.loadXML=function(e,t){for(var i=this._getBaseURL(t),n=e.documentElement.getAttribute("wiki-url"),a=e.documentElement.getAttribute("wiki-section"),r=e.documentElement.getAttribute("date-time-format"),s=this._events.getUnit().getParser(r),l=e.documentElement.firstChild,o=!1;null!=l;){if(1==l.nodeType){var h="";null!=l.firstChild&&3==l.firstChild.nodeType&&(h=l.firstChild.nodeValue);var c=null===l.getAttribute("isDuration")&&null===l.getAttribute("durationEvent")||"false"==l.getAttribute("isDuration")||"false"==l.getAttribute("durationEvent"),m=new Timeline.DefaultEventSource.Event({id:l.getAttribute("id"),start:s(l.getAttribute("start")),end:s(l.getAttribute("end")),latestStart:s(l.getAttribute("latestStart")),earliestEnd:s(l.getAttribute("earliestEnd")),instant:c,text:l.getAttribute("title"),description:h,image:this._resolveRelativeURL(l.getAttribute("image"),i),link:this._resolveRelativeURL(l.getAttribute("link"),i),icon:this._resolveRelativeURL(l.getAttribute("icon"),i),color:l.getAttribute("color"),textColor:l.getAttribute("textColor"),hoverText:l.getAttribute("hoverText"),classname:l.getAttribute("classname"),tapeImage:l.getAttribute("tapeImage"),tapeRepeat:l.getAttribute("tapeRepeat"),caption:l.getAttribute("caption"),eventID:l.getAttribute("eventID"),trackNum:l.getAttribute("trackNum")});m._node=l,m.getProperty=function(e){return this._node.getAttribute(e)},m.setWikiInfo(n,a),this._events.add(m),o=!0}l=l.nextSibling}o&&this._fire("onAddMany",[])},Timeline.DefaultEventSource.prototype.loadJSON=function(e,t){var i=this._getBaseURL(t),n=!1;if(e&&e.events)for(var a=("wikiURL"in e?e.wikiURL:null),r=("wikiSection"in e?e.wikiSection:null),s=("dateTimeFormat"in e?e.dateTimeFormat:null),l=this._events.getUnit().getParser(s),o=0;o<e.events.length;o++){var h=e.events[o],c=h.isDuration||null!=h.durationEvent&&!h.durationEvent,m=new Timeline.DefaultEventSource.Event({id:"id"in h?h.id:void 0,start:l(h.start),end:l(h.end),latestStart:l(h.latestStart),earliestEnd:l(h.earliestEnd),instant:c,text:h.title,description:h.description,image:this._resolveRelativeURL(h.image,i),link:this._resolveRelativeURL(h.link,i),icon:this._resolveRelativeURL(h.icon,i),color:h.color,textColor:h.textColor,hoverText:h.hoverText,classname:h.classname,tapeImage:h.tapeImage,tapeRepeat:h.tapeRepeat,caption:h.caption,eventID:h.eventID,trackNum:h.trackNum});m._obj=h,m.getProperty=function(e){return this._obj[e]},m.setWikiInfo(a,r),this._events.add(m),n=!0}n&&this._fire("onAddMany",[])},Timeline.DefaultEventSource.prototype.loadSPARQL=function(e,t){var i=this._getBaseURL(t),n="iso8601",a=this._events.getUnit().getParser(n);if(null!=e){for(var r=e.documentElement.firstChild;null!=r&&(1!=r.nodeType||"results"!=r.nodeName);)r=r.nextSibling;var s=null,l=null;null!=r&&(s=r.getAttribute("wiki-url"),l=r.getAttribute("wiki-section"),r=r.firstChild);for(var o=!1;null!=r;){if(1==r.nodeType){for(var h={},c=r.firstChild;null!=c;)1==c.nodeType&&null!=c.firstChild&&1==c.firstChild.nodeType&&null!=c.firstChild.firstChild&&3==c.firstChild.firstChild.nodeType&&(h[c.getAttribute("name")]=c.firstChild.firstChild.nodeValue),c=c.nextSibling;null==h.start&&null!=h.date&&(h.start=h.date);var m=null===h.isDuration&&null===h.durationEvent||"false"==h.isDuration||"false"==h.durationEvent,p=new Timeline.DefaultEventSource.Event({id:h.id,start:a(h.start),end:a(h.end),latestStart:a(h.latestStart),earliestEnd:a(h.earliestEnd),instant:m,text:h.title,description:h.description,image:this._resolveRelativeURL(h.image,i),link:this._resolveRelativeURL(h.link,i),icon:this._resolveRelativeURL(h.icon,i),color:h.color,textColor:h.textColor,hoverText:h.hoverText,caption:h.caption,classname:h.classname,tapeImage:h.tapeImage,tapeRepeat:h.tapeRepeat,eventID:h.eventID,trackNum:h.trackNum});p._bindings=h,p.getProperty=function(e){return this._bindings[e]},p.setWikiInfo(s,l),this._events.add(p),o=!0}r=r.nextSibling}o&&this._fire("onAddMany",[])}},Timeline.DefaultEventSource.prototype.add=function(e){this._events.add(e),this._fire("onAddOne",[e])},Timeline.DefaultEventSource.prototype.addMany=function(e){for(var t=0;t<e.length;t++)this._events.add(e[t]);this._fire("onAddMany",[])},Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll(),this._fire("onClear",[])},Timeline.DefaultEventSource.prototype.getEvent=function(e){return this._events.getEvent(e)},Timeline.DefaultEventSource.prototype.getEventIterator=function(e,t){return this._events.getIterator(e,t)},Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(e,t){return this._events.getReverseIterator(e,t)},Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()},Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()},Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()},Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()},Timeline.DefaultEventSource.prototype._fire=function(e,t){for(var i=0;i<this._listeners.length;i++){var n=this._listeners[i];if(e in n)try{n[e].apply(n,t)}catch(a){SimileAjax.Debug.exception(a)}}},Timeline.DefaultEventSource.prototype._getBaseURL=function(e){if(e.indexOf("://")<0){var t=this._getBaseURL(document.location.href);e="/"==e.substr(0,1)?t.substr(0,t.indexOf("/",t.indexOf("://")+3))+e:t+e}var i=e.lastIndexOf("/");return 0>i?"":e.substr(0,i+1)},Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(e,t){return null==e||""==e?e:e.indexOf("://")>0?e:"/"==e.substr(0,1)?t.substr(0,t.indexOf("/",t.indexOf("://")+3))+e:t+e},Timeline.DefaultEventSource.Event=function(e){function t(t){return null!=e[t]&&""!=e[t]?e[t]:null}var i=e.id?e.id.trim():"";this._id=i.length>0?i:Timeline.EventUtils.getNewEventID(),this._instant=e.instant||null==e.end,this._start=e.start,this._end=null!=e.end?e.end:e.start,this._latestStart=null!=e.latestStart?e.latestStart:e.instant?this._end:this._start,this._earliestEnd=null!=e.earliestEnd?e.earliestEnd:this._end;var n=[];this._start>this._latestStart&&(this._latestStart=this._start,n.push("start is > latestStart")),this._start>this._earliestEnd&&(this._earliestEnd=this._latestStart,n.push("start is > earliestEnd")),this._start>this._end&&(this._end=this._earliestEnd,n.push("start is > end")),this._latestStart>this._earliestEnd&&(this._earliestEnd=this._latestStart,n.push("latestStart is > earliestEnd")),this._latestStart>this._end&&(this._end=this._earliestEnd,n.push("latestStart is > end")),this._earliestEnd>this._end&&(this._end=this._earliestEnd,n.push("earliestEnd is > end")),this._eventID=t("eventID"),this._text=null!=e.text?SimileAjax.HTML.deEntify(e.text):"",n.length>0&&(this._text+=" PROBLEM: "+n.join(", ")),this._description=SimileAjax.HTML.deEntify(e.description),this._image=t("image"),this._link=t("link"),this._title=t("hoverText"),this._title=t("caption"),this._icon=t("icon"),this._color=t("color"),this._textColor=t("textColor"),this._classname=t("classname"),this._tapeImage=t("tapeImage"),this._tapeRepeat=t("tapeRepeat"),this._trackNum=t("trackNum"),null!=this._trackNum&&(this._trackNum=parseInt(this._trackNum)),this._wikiURL=null,this._wikiSection=null},Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(e){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},setWikiInfo:function(e,t){this._wikiURL=e,this._wikiSection=t},fillDescription:function(e){e.innerHTML=this._description},fillWikiInfo:function(e){if(e.style.display="none",null!=this._wikiURL&&null!=this._wikiSection){var t=this.getProperty("wikiID");if((null==t||0==t.length)&&(t=this.getText()),null!=t&&0!=t.length){e.style.display="inline",t=t.replace(/\s/g,"_");var i=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+t,n=document.createElement("a");
n.href=i,n.target="new",n.innerHTML=Timeline.strings[Timeline.clientLocale].wikiLinkLabel,e.appendChild(document.createTextNode("[")),e.appendChild(n),e.appendChild(document.createTextNode("]"))}}},fillTime:function(e,t){this._instant?this.isImprecise()?(e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start))),e.appendChild(e.ownerDocument.createElement("br")),e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._end)))):e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start))):this.isImprecise()?(e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start)+" ~ "+t.labelPrecise(this._latestStart))),e.appendChild(e.ownerDocument.createElement("br")),e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._earliestEnd)+" ~ "+t.labelPrecise(this._end)))):(e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start))),e.appendChild(e.ownerDocument.createElement("br")),e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._end))))},fillInfoBubble:function(e,t,i){var n=e.ownerDocument,a=this.getText(),r=this.getLink(),s=this.getImage();if(null!=s){var l=n.createElement("img");l.src=s,t.event.bubble.imageStyler(l),e.appendChild(l)}var o=n.createElement("div"),h=n.createTextNode(a);if(null!=r){var c=n.createElement("a");c.href=r,c.appendChild(h),o.appendChild(c)}else o.appendChild(h);t.event.bubble.titleStyler(o),e.appendChild(o);var m=n.createElement("div");this.fillDescription(m),t.event.bubble.bodyStyler(m),e.appendChild(m);var p=n.createElement("div");this.fillTime(p,i),t.event.bubble.timeStyler(p),e.appendChild(p);var _=n.createElement("div");this.fillWikiInfo(_),t.event.bubble.wikiStyler(_),e.appendChild(_)}},Timeline.ClassicTheme=new Object,Timeline.ClassicTheme.implementations=[],Timeline.ClassicTheme.create=function(e){null==e&&(e=Timeline.getDefaultLocale());var t=Timeline.ClassicTheme.implementations[e];return null==t&&(t=Timeline.ClassicTheme._Impl),new t},Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0,this.autoWidth=!1,this.autoWidthAnimationTime=500,this.timeline_start=null,this.timeline_stop=null,this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:!0,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}},this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:!1,bubble:{width:250,maxHeight:0,titleStyler:function(e){e.className="timeline-event-bubble-title"},bodyStyler:function(e){e.className="timeline-event-bubble-body"},imageStyler:function(e){e.className="timeline-event-bubble-image"},wikiStyler:function(e){e.className="timeline-event-bubble-wiki"},timeStyler:function(e){e.className="timeline-event-bubble-time"}}},this.mouseWheel="scroll"},Timeline.version="2.3.1",Timeline.ajax_lib_version=SimileAjax.version,Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")",Timeline.strings={},Timeline.HORIZONTAL=0,Timeline.VERTICAL=1,Timeline._defaultTheme=null,Timeline.getDefaultLocale=function(){return Timeline.clientLocale},Timeline.create=function(e,t,i,n){null==Timeline.timelines&&(Timeline.timelines=[]);var a=Timeline.timelines.length;Timeline.timelines[a]=null;var r=new Timeline._Impl(e,t,i,n,a);return Timeline.timelines[a]=r,r},Timeline.createBandInfo=function(e){var t="theme"in e?e.theme:Timeline.getDefaultTheme(),i="eventSource"in e?e.eventSource:null,n=new Timeline.LinearEther({centersOn:"date"in e?e.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[e.intervalUnit],pixelsPerInterval:e.intervalPixels,theme:t}),a=new Timeline.GregorianEtherPainter({unit:e.intervalUnit,multiple:"multiple"in e?e.multiple:1,theme:t,align:"align"in e?e.align:void 0}),r={showText:"showEventText"in e?e.showEventText:!0,theme:t};if("eventPainterParams"in e)for(var s in e.eventPainterParams)r[s]=e.eventPainterParams[s];"trackHeight"in e&&(r.trackHeight=e.trackHeight),"trackGap"in e&&(r.trackGap=e.trackGap);var l,o="overview"in e&&e.overview?"overview":"layout"in e?e.layout:"original";if("eventPainter"in e)l=new e.eventPainter(r);else switch(o){case"overview":l=new Timeline.OverviewEventPainter(r);break;case"detailed":l=new Timeline.DetailedEventPainter(r);break;default:l=new Timeline.OriginalEventPainter(r)}return{width:e.width,eventSource:i,timeZone:"timeZone"in e?e.timeZone:0,ether:n,etherPainter:a,eventPainter:l,theme:t,zoomIndex:"zoomIndex"in e?e.zoomIndex:0,zoomSteps:"zoomSteps"in e?e.zoomSteps:null}},Timeline.createHotZoneBandInfo=function(e){var t="theme"in e?e.theme:Timeline.getDefaultTheme(),i="eventSource"in e?e.eventSource:null,n=new Timeline.HotZoneEther({centersOn:"date"in e?e.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[e.intervalUnit],pixelsPerInterval:e.intervalPixels,zones:e.zones,theme:t}),a=new Timeline.HotZoneGregorianEtherPainter({unit:e.intervalUnit,zones:e.zones,theme:t,align:"align"in e?e.align:void 0}),r={showText:"showEventText"in e?e.showEventText:!0,theme:t};if("eventPainterParams"in e)for(var s in e.eventPainterParams)r[s]=e.eventPainterParams[s];"trackHeight"in e&&(r.trackHeight=e.trackHeight),"trackGap"in e&&(r.trackGap=e.trackGap);var l,o="overview"in e&&e.overview?"overview":"layout"in e?e.layout:"original";if("eventPainter"in e)l=new e.eventPainter(r);else switch(o){case"overview":l=new Timeline.OverviewEventPainter(r);break;case"detailed":l=new Timeline.DetailedEventPainter(r);break;default:l=new Timeline.OriginalEventPainter(r)}return{width:e.width,eventSource:i,timeZone:"timeZone"in e?e.timeZone:0,ether:n,etherPainter:a,eventPainter:l,theme:t,zoomIndex:"zoomIndex"in e?e.zoomIndex:0,zoomSteps:"zoomSteps"in e?e.zoomSteps:null}},Timeline.getDefaultTheme=function(){return null==Timeline._defaultTheme&&(Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale())),Timeline._defaultTheme},Timeline.setDefaultTheme=function(e){Timeline._defaultTheme=e},Timeline.loadXML=function(e,t){var i=function(t,i,n){alert("Failed to load data xml from "+e+"\n"+t)},n=function(i){var n=i.responseXML;!n.documentElement&&i.responseStream&&n.load(i.responseStream),t(n,e)};SimileAjax.XmlHttp.get(e,i,n)},Timeline.loadJSON=function(url,f){var fError=function(e,t,i){alert("Failed to load json data from "+url+"\n"+e)},fDone=function(xmlhttp){f(eval("("+xmlhttp.responseText+")"),url)};SimileAjax.XmlHttp.get(url,fError,fDone)},Timeline.getTimelineFromID=function(e){return Timeline.timelines[e]},Timeline.writeVersion=function(e){document.getElementById(e).innerHTML=this.display_version},Timeline._Impl=function(e,t,i,n,a){SimileAjax.WindowManager.initialize(),this._containerDiv=e,this._bandInfos=t,this._orientation=null==i?Timeline.HORIZONTAL:i,this._unit=null!=n?n:SimileAjax.NativeDateUnit,this._starting=!0,this._autoResizing=!1,this.autoWidth=t&&t[0]&&t[0].theme&&t[0].theme.autoWidth,this.autoWidthAnimationTime=t&&t[0]&&t[0].theme&&t[0].theme.autoWidthAnimationTime,this.timelineID=a,this.timeline_start=t&&t[0]&&t[0].theme&&t[0].theme.timeline_start,this.timeline_stop=t&&t[0]&&t[0].theme&&t[0].theme.timeline_stop,this.timeline_at_start=!1,this.timeline_at_stop=!1,this._initialize()},Timeline._Impl.prototype.dispose=function(){for(var e=0;e<this._bands.length;e++)this._bands[e].dispose();this._bands=null,this._bandInfos=null,this._containerDiv.innerHTML="",Timeline.timelines[this.timelineID]=null},Timeline._Impl.prototype.getBandCount=function(){return this._bands.length},Timeline._Impl.prototype.getBand=function(e){return this._bands[e]},Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(!0),this._starting=!1},Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(!0),this._distributeWidths()},Timeline._Impl.prototype.paint=function(){for(var e=0;e<this._bands.length;e++)this._bands[e].paint()},Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument},Timeline._Impl.prototype.addDiv=function(e){this._containerDiv.appendChild(e)},Timeline._Impl.prototype.removeDiv=function(e){this._containerDiv.removeChild(e)},Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL},Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL},Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight},Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight},Timeline._Impl.prototype.getUnit=function(){return this._unit},Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"},Timeline._Impl.prototype.loadXML=function(e,t){var i=this,n=function(t,n,a){alert("Failed to load data xml from "+e+"\n"+t),i.hideLoadingMessage()},a=function(n){try{var a=n.responseXML;!a.documentElement&&n.responseStream&&a.load(n.responseStream),t(a,e)}finally{i.hideLoadingMessage()}};this.showLoadingMessage(),window.setTimeout(function(){SimileAjax.XmlHttp.get(e,n,a)},0)},Timeline._Impl.prototype.loadJSON=function(url,f){var tl=this,fError=function(e,t,i){alert("Failed to load json data from "+url+"\n"+e),tl.hideLoadingMessage()},fDone=function(xmlhttp){try{f(eval("("+xmlhttp.responseText+")"),url)}finally{tl.hideLoadingMessage()}};this.showLoadingMessage(),window.setTimeout(function(){SimileAjax.XmlHttp.get(url,fError,fDone)},0)},Timeline._Impl.prototype._autoWidthScrollListener=function(e){e.getTimeline()._autoWidthCheck(!1)},Timeline._Impl.prototype._autoWidthCheck=function(e){function t(){var e=n.getWidthStyle();if(a)n._containerDiv.style[e]=r+"px";else{n._autoResizing=!0;var t={};t[e]=r+"px",SimileAjax.jQuery(n._containerDiv).animate(t,n.autoWidthAnimationTime,"linear",function(){n._autoResizing=!1})}}function i(){var i=0,a=n.getPixelWidth();if(!n._autoResizing){for(var s=0;s<n._bands.length;s++)n._bands[s].checkAutoWidth(),i+=n._bandInfos[s].width;(i>a||e)&&(r=i,t(),n._distributeWidths())}}var n=this,a=n._starting,r=0;n.autoWidth&&i()},Timeline._Impl.prototype._initialize=function(){var e=this._containerDiv,t=e.ownerDocument;e.className=e.className.split(" ").concat("timeline-container").join(" ");var i=this.isHorizontal()?"horizontal":"vertical";for(e.className+=" timeline-"+i;e.firstChild;)e.removeChild(e.firstChild);var n=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));n.className="timeline-copyright",n.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/",SimileAjax.DOM.registerEvent(n,"click",function(){window.location="http://code.google.com/p/simile-widgets/"}),e.appendChild(n),this._bands=[];for(var a=0;a<this._bandInfos.length;a++){var r=new Timeline._Band(this,this._bandInfos[a],a);this._bands.push(r)}this._distributeWidths();for(var a=0;a<this._bandInfos.length;a++){var s=this._bandInfos[a];"syncWith"in s&&this._bands[a].setSyncWithBand(this._bands[s.syncWith],"highlight"in s?s.highlight:!1)}if(this.autoWidth)for(var a=0;a<this._bands.length;a++)this._bands[a].addOnScrollListener(this._autoWidthScrollListener);var l=SimileAjax.Graphics.createMessageBubble(t);l.containerDiv.className="timeline-message-container",e.appendChild(l.containerDiv),l.contentDiv.className="timeline-message",l.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...",this.showLoadingMessage=function(){l.containerDiv.style.display="block"},this.hideLoadingMessage=function(){l.containerDiv.style.display="none"}},Timeline._Impl.prototype._distributeWidths=function(){for(var e=this.getPixelLength(),t=this.getPixelWidth(),i=0,n=0;n<this._bands.length;n++){var a,r=this._bands[n],s=this._bandInfos[n],l=s.width;if("string"==typeof l){var o=l.indexOf("%");if(o>0){var h=parseInt(l.substr(0,o));a=Math.round(h*t/100)}else a=parseInt(l)}else a=l;r.setBandShiftAndWidth(i,a),r.setViewLength(e),i+=a}},Timeline._Impl.prototype.shiftOK=function(e,t){var i=t>0,n=0>t;if(i&&null==this.timeline_start||n&&null==this.timeline_stop||0==t)return!0;for(var a=!1,r=0;r<this._bands.length&&!a;r++)a=this._bands[r].busy();if(a)return!0;if(i&&this.timeline_at_start||n&&this.timeline_at_stop)return!1;for(var s=!1,r=0;r<this._bands.length&&!s;r++){var l=this._bands[r];s=i?(r==e?l.getMinVisibleDateAfterDelta(t):l.getMinVisibleDate())>=this.timeline_start:(r==e?l.getMaxVisibleDateAfterDelta(t):l.getMaxVisibleDate())<=this.timeline_stop}return i?(this.timeline_at_start=!s,this.timeline_at_stop=!1):(this.timeline_at_stop=!s,this.timeline_at_start=!1),s},Timeline._Impl.prototype.zoom=function(e,t,i,n){var a=new RegExp("^timeline-band-([0-9]+)$"),r=null,s=a.exec(n.id);s&&(r=parseInt(s[1])),null!=r&&this._bands[r].zoom(e,t,i,n),this.paint()},Timeline.NativeDateUnit=new Object,Timeline.NativeDateUnit.createLabeller=function(e,t){return new Timeline.GregorianDateLabeller(e,t)},Timeline.NativeDateUnit.makeDefaultValue=function(){return new Date},Timeline.NativeDateUnit.cloneValue=function(e){return new Date(e.getTime())},Timeline.NativeDateUnit.getParser=function(e){return"string"==typeof e&&(e=e.toLowerCase()),"iso8601"==e||"iso 8601"==e?Timeline.DateTime.parseIso8601DateTime:Timeline.DateTime.parseGregorianDateTime},Timeline.NativeDateUnit.parseFromObject=function(e){return Timeline.DateTime.parseGregorianDateTime(e)},Timeline.NativeDateUnit.toNumber=function(e){return e.getTime()},Timeline.NativeDateUnit.fromNumber=function(e){return new Date(e)},Timeline.NativeDateUnit.compare=function(e,t){var i,n;return i="object"==typeof e?e.getTime():Number(e),n="object"==typeof t?t.getTime():Number(t),i-n},Timeline.NativeDateUnit.earlier=function(e,t){return Timeline.NativeDateUnit.compare(e,t)<0?e:t},Timeline.NativeDateUnit.later=function(e,t){return Timeline.NativeDateUnit.compare(e,t)>0?e:t},Timeline.NativeDateUnit.change=function(e,t){return new Date(e.getTime()+t)};